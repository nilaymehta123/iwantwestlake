!function(e){_.isUndefined(window.vc)&&(window.vc={}),vc.showSpinner=function(){e("#vc_logo").addClass("vc_ajax-loading")},vc.hideSpinner=function(){e("#vc_logo").removeClass("vc_ajax-loading")},e(document).ajaxSend(function(e,t,i){i&&i.data&&"string"==typeof i.data&&i.data.match(/vc_inline=true/)&&vc.showSpinner()}).ajaxStop(function(){vc.hideSpinner()}),vc.active_panel=!1,vc.closeActivePanel=function(e){return this.active_panel?void(e&&vc.active_panel.model&&vc.active_panel.model.get("id")===e.get("id")?this.active_panel.hide():e||this.active_panel.hide()):!1},vc.activePanelName=function(){return this.active_panel&&this.active_panel.panelName?this.active_panel.panelName:null},vc.updateSettingsBadge=function(){var t=vc.$custom_css.val();t&&""!==t.trim()?e("#vc_post-css-badge").show():e("#vc_post-css-badge").hide()},vc.ModalView=Backbone.View.extend({message_box_timeout:!1,events:{"hidden.bs.modal":"hide","shown.bs.modal":"shown"},initialize:function(){_.bindAll(this,"setSize","hide")},setSize:function(){var t=e(window).height()-150;this.$content.css("maxHeight",t)},render:function(){return e(window).bind("resize.ModalView",this.setSize),this.setSize(),vc.closeActivePanel(),this.$el.modal("show"),this},showMessage:function(t,i){this.message_box_timeout&&this.$el.find(".vc_message").remove()&&window.clearTimeout(this.message_box_timeout),this.message_box_timeout=!1;var a=e('<div class="vc_message type-'+i+'"></div>');this.$el.find(".vc_modal-body").prepend(a),a.text(t).fadeIn(),this.message_box_timeout=window.setTimeout(function(){a.remove()},6e3)},hide:function(){e(window).unbind("resize.ModalView")},shown:function(){}}),vc.element_start_index=0,vc.AddElementBlockView=vc.ModalView.extend({el:e("#vc_add-element-dialog"),prepend:!1,builder:"",events:{"click .vc_shortcode-link":"createElement","keyup #vc_elements_name_filter":"filterElements","hidden.bs.modal":"hide","show.bs.modal":"buildFiltering","click .wpb-content-layouts-container [data-filter]":"filterElements","shown.bs.modal":"shown"},buildFiltering:function(){this.do_render=!1;var t,i,a;t=".wpb-layout-element-button",i=this.model?this.model.get("shortcode"):"vc_column",a=this._getNotIn(i),e("#vc_elements_name_filter").val(""),this.$content.addClass("vc_filter-all"),this.$content.attr("data-vc_filter","*");var n=i&&!_.isUndefined(vc.getMapped(i).as_parent)?vc.getMapped(i).as_parent:!1;if(_.isObject(n)){var s=[];_.isString(n.only)&&s.push(_.reduce(n.only.replace(/\s/,"").split(","),function(e,t){return e+(_.isEmpty(e)?"":",")+'[data-element="'+t.trim()+'"]'},"")),_.isString(n.except)&&s.push(_.reduce(n.except.replace(/\s/,"").split(","),function(e,t){return e+':not([data-element="'+t.trim()+'"])'},"")),t+=s.join(",")}else a&&(t=a);i===!1||i===!1||_.isUndefined(vc.getMapped(i).allowed_container_element)||(vc.getMapped(i).allowed_container_element===!1?t+=":not([data-is-container=true])":_.isString(vc.getMapped(i).allowed_container_element)&&(t+=":not([data-is-container=true]), [data-element="+vc.getMapped(i).allowed_container_element+"]")),this.$buttons.removeClass("vc_visible").addClass("vc_inappropriate"),e(t,this.$content).removeClass("vc_inappropriate").addClass("vc_visible"),this.hideEmptyFilters()},hideEmptyFilters:function(){this.$el.find(".vc_filter-content-elements .active").removeClass("active"),this.$el.find(".vc_filter-content-elements > :first").addClass("active");var t=this;this.$el.find("[data-filter]").each(function(){e(e(this).data("filter")+".vc_visible:not(.vc_inappropriate)",t.$content).length?e(this).parent().show():e(this).parent().hide()})},render:function(t,i){return this.builder=new vc.ShortcodesBuilder,this.prepend=_.isBoolean(i)?i:!1,this.place_after_id=_.isString(i)?i:!1,this.model=_.isObject(t)?t:!1,this.$content=this.$el.find(".wpb-elements-list"),this.$buttons=e(".wpb-layout-element-button",this.$content),this.preventDoubleExecution=!1,vc.AddElementBlockView.__super__.render.call(this)},hide:function(){e(window).unbind("resize.vcAddElementModal"),this.do_render&&(this.show_settings&&this.showEditForm(),this.exit())},showEditForm:function(){vc.edit_element_block_view.render(this.builder.last())},exit:function(){this.builder.render()},createElement:function(t){var i;if(!this.preventDoubleExecution){this.preventDoubleExecution=!0,this.do_render=!0,t.preventDefault();var a=e(t.currentTarget),n=a.data("tag");this.model===!1&&"vc_row"!==n?(this.builder.create({shortcode:"vc_row"}).create({shortcode:"vc_column",parent_id:this.builder.lastID(),params:{width:"1/1"}}),this.model=this.builder.last()):this.model!==!1&&"vc_row"===n&&(n+="_inner");var s={shortcode:n,parent_id:this.model?this.model.get("id"):!1};if(this.prepend){s.order=0;var o=vc.shortcodes.findWhere({parent_id:this.model.get("id")});o&&(s.order=o.get("order")-1),vc.activity="prepend"}else this.place_after_id&&(s.place_after_id=this.place_after_id);if(this.builder.create(s),"vc_row"===n?this.builder.create({shortcode:"vc_column",parent_id:this.builder.lastID(),params:{width:"1/1"}}):"vc_row_inner"===n&&this.builder.create({shortcode:"vc_column_inner",parent_id:this.builder.lastID(),params:{width:"1/1"}}),_.isString(vc.getMapped(n).default_content)&&vc.getMapped(n).default_content.length){var c=this.builder.parse({},vc.getMapped(n).default_content,this.builder.last().toJSON());_.each(c,function(e){e.default_content=!0,this.builder.create(e)},this)}this.show_settings=_.isBoolean(vc.getMapped(n).show_settings_on_create)&&vc.getMapped(n).show_settings_on_create===!1?!1:!0,i=this,this.$el.one("hidden.bs.modal",function(){i.preventDoubleExecution=!1}).modal("hide")}},getDefaultParams:function(e){var t={};return _.each(vc.getMapped(e).params,function(e){_.isUndefined(e.value)||(t[e.param_name]=vc.atts[e.type]&&vc.atts[e.type].defaults?vc.atts[e.type].defaults():e.value)}),t},_getNotIn:_.memoize(function(e){var t=_.reduce(vc.map,function(t,i){var a=_.isEmpty(t)?"":",";return _.isObject(i.as_child)?(_.isString(i.as_child.only)&&(_.contains(i.as_child.only.replace(/\s/,"").split(","),e)||(t+=a+"[data-element="+i.base+"]")),_.isString(i.as_child.except)&&_.contains(i.as_child.except.replace(/\s/,"").split(","),e)&&(t+=a+"[data-element="+i.base+"]")):i.as_child===!1&&(t+=a+"[data-element="+i.base+"]"),t},"");return".wpb-layout-element-button:not("+t+")"}),filterElements:function(t){t.stopPropagation(),t.preventDefault();var i=e(t.currentTarget),a=".wpb-layout-element-button",n=e("#vc_elements_name_filter").val();if(this.$content.removeClass("vc_filter-all"),i.is("[data-filter]")){e(".wpb-content-layouts-container .isotope-filter .active",this.$content).removeClass("active"),i.parent().addClass("active");var s=i.data("filter");a+=s,"*"==s?this.$content.addClass("vc_filter-all"):this.$content.removeClass("vc_filter-all"),this.$content.attr("data-vc_filter",s.replace(".category-","")),e("#vc_elements_name_filter").val("")}else n.length>0?(a+=":containsi('"+n+"'):not('.vc_element-deprecated')",e(".wpb-content-layouts-container .isotope-filter .active",this.$content).removeClass("active"),this.$content.attr("data-vc_filter","name:"+n)):0==n.length&&(e('.wpb-content-layouts-container .isotope-filter [data-filter="*"]').parent().addClass("active"),this.$content.attr("data-vc_filter","*"),this.$content.addClass("vc_filter-all"));e(".vc_visible",this.$content).removeClass("vc_visible"),e(a,this.$content).addClass("vc_visible")},shown:function(){vc.is_mobile||e("#vc_elements_name_filter").focus()}}),vc.AddElementBlockViewBackendEditor=vc.AddElementBlockView.extend({render:function(t,i){return this.prepend=_.isBoolean(i)?i:!1,this.place_after_id=_.isString(i)?i:!1,this.model=_.isObject(t)?t:!1,this.$content=this.$el.find(".wpb-elements-list"),this.$buttons=e(".wpb-layout-element-button",this.$content),vc.AddElementBlockView.__super__.render.call(this)},createElement:function(t){var i;if(!this.preventDoubleExecution){this.preventDoubleExecution=!0;var a,n,s;_.isObject(t)&&t.preventDefault(),this.do_render=!0;var o=e(t.currentTarget).data("tag");this.model===!1?(s=vc.shortcodes.create({shortcode:"vc_row"}),n=vc.shortcodes.create({shortcode:"vc_column",params:{width:"1/1"},parent_id:s.id,root_id:s.id}),a="vc_row"!=o?vc.shortcodes.create({shortcode:o,parent_id:n.id,root_id:s.id}):s):"vc_row"==o?(s=vc.shortcodes.create({shortcode:"vc_row_inner",parent_id:this.model.id,order:this.prepend?this.getFirstPositionIndex():vc.shortcodes.getNextOrder()}),a=vc.shortcodes.create({shortcode:"vc_column_inner",params:{width:"1/1"},parent_id:s.id,root_id:s.id})):a=vc.shortcodes.create({shortcode:o,parent_id:this.model.id,order:this.prepend?this.getFirstPositionIndex():vc.shortcodes.getNextOrder(),root_id:this.model.get("root_id")}),this.show_settings=_.isBoolean(vc.getMapped(o).show_settings_on_create)&&vc.getMapped(o).show_settings_on_create===!1?!1:!0,this.model=a,i=this,this.$el.one("hidden.bs.modal",function(){i.preventDoubleExecution=!1}).modal("hide")}},showEditForm:function(){vc.edit_element_block_view.render(this.model)},exit:function(){},getFirstPositionIndex:function(){return vc.element_start_index-=1,vc.element_start_index}}),vc.PanelView=Backbone.View.extend({panelName:"panel",draggable:!1,$body:!1,$tabs:!1,$content:!1,events:{"click [data-dismiss=panel]":"hide","mouseover [data-transparent=panel]":"addOpacity","click [data-transparent=panel]":"toggleOpacity","mouseout [data-transparent=panel]":"removeOpacity","click .vc_panel-tabs-link":"changeTab"},options:{startTab:0},clicked:!1,initialize:function(){this.clicked=!1,this.$el.removeClass("vc_panel-opacity"),this.$body=e("body"),this.$content=this.$el.find(".vc_panel-body"),_.bindAll(this,"setSize","fixElContainment","changeTab","setTabsSize")},toggleOpacity:function(){this.clicked=!this.clicked},addOpacity:function(){!this.clicked&&this.$el.addClass("vc_panel-opacity")},removeOpacity:function(){!this.clicked&&this.$el.removeClass("vc_panel-opacity")},message_box_timeout:!1,init:function(){},show:function(){vc.closeActivePanel(),this.init(),vc.active_panel=this,this.clicked=!1,this.$el.css("height","auto"),this.$el.removeClass("vc_panel-opacity");var t=this.$el.find(".vc_panel-tabs");t.length&&(this.$tabs=t,this.setTabs()),e(window).unbind("resize.vcPropertyPanel").bind("resize.vcPropertyPanel",this.setSize),this.setSize(),this.$el.show(),this.draggable?e(window).trigger("resize"):this.initDraggable(),this.fixElContainment()},hide:function(t){t&&t.preventDefault(),e(window).unbind("resize.vcPropertyPanel"),vc.active_panel=!1,this.$el.hide()},content:function(){return this.$el.find(".panel-body")},fixElContainment:function(){this.$body||(this.$body=e("body"));var t=this.$el.width(),i=(this.$el.height(),this.$body.width()),a=this.$body.height(),n=[-t+20,0,i-20,a-30],s=this.$el.position(),o={};s.left<n[0]&&(o.left=n[0]),s.top<0&&(o.top=0),s.left>n[2]&&(o.left=n[2]),s.top>n[3]&&(o.top=n[3]),this.$el.css(o)},initDraggable:function(){this.$el.draggable({iframeFix:!0,handle:".vc_panel-heading",start:this.fixElContainment,stop:this.fixElContainment}),e(window).unbind("resize.fixElContainment").bind("resize.fixElContainment",this.fixElContainment),e(window).unbind("scroll.fixElContainment").bind("scroll.fixElContainment",this.fixElContainment),this.draggable=!0},setSize:function(){var t=e(window).height()-parseInt(this.$el.css("top"))-170;95>t&&(t=95),this.$content.css("maxHeight",t)},setTabs:function(){this.$tabs.length&&(this.$tabs.find(".vc_panel-tabs-control").removeClass("vc_active").eq(this.options.startTab).addClass("vc_active"),this.$tabs.find(".vc_panel-tab").removeClass("vc_active").eq(this.options.startTab).addClass("vc_active"),window.setTimeout(this.setTabsSize,100))},setTabsSize:function(){this.$tabs&&this.$tabs.parents(".vc_with-tabs.vc_panel-body").css("margin-top",this.$tabs.find(".vc_panel-tabs-menu").outerHeight())},changeTab:function(t){if(t&&t.preventDefault&&t.preventDefault(),t.target&&this.$tabs){var i=e(t.target);this.$tabs.find(".vc_active").removeClass("vc_active"),i.parent().addClass("vc_active"),this.$el.find(i.data("target")).addClass("vc_active"),window.setTimeout(this.setTabsSize,100)}},showMessage:function(t,i){this.message_box_timeout&&this.$el.find(".vc_panel-message").remove()&&window.clearTimeout(this.message_box_timeout),this.message_box_timeout=!1;var a=e('<div class="vc_panel-message type-'+i+'"></div>').appendTo(this.$el.find(".vc_panel-body"));a.text(t).fadeIn(),this.message_box_timeout=window.setTimeout(function(){a.remove()},6e3)},minimizeBody:function(e){e&&e.preventDefault&&e.preventDefault(),this.$el.find(".panel-body,.panel-footer").slideToggle()},isVisible:function(){return this.$el.is(":visible")}}),vc.EditElementPanelView=vc.PanelView.extend({panelName:"edit_element",el:e("#vc_properties-panel"),tabsInit:!1,doCheckTabs:!0,$tabsMenu:!1,dependent_elements:{},mapped_params:{},draggable:!1,panelInit:!1,$spinner:!1,ajax:!1,events:{"click [data-save=true]":"save","click [data-dismiss=panel]":"hide","mouseover [data-transparent=panel]":"addOpacity","click [data-transparent=panel]":"toggleOpacity","mouseout [data-transparent=panel]":"removeOpacity"},initialize:function(){_.bindAll(this,"setSize","setTabsSize","fixElContainment")},render:function(t,i){this.$el.is(":hidden")&&vc.closeActivePanel(),this.model=t,vc.active_panel=this,this.$el.removeClass("vc_panel-opacity"),this.clicked=!1,this.$el.css("height","auto");var a=(this.model.get("shortcode"),this.model.setting("params")||[]);return _.bindAll(this,"hookDependent"),this.$el.attr("data-vc-shortcode",this.model.get("shortcode")),this.tabsInit=!1,this.mapped_params={},this.dependent_elements={},_.each(a,function(e){this.mapped_params[e.param_name]=e},this),this.$content=i?this.$el:this.$el.find(".vc_properties-list").removeClass("vc_with-tabs"),this.$content.html(""),this.$spinner=e('<span class="vc_spinner"></span>'),this.$content.prepend(this.$spinner),this.show(),this.ajax=e.ajax({type:"POST",url:window.ajaxurl,data:this.ajaxData(),context:this}).done(function(t){var i=e(t).hide();this.$content.html(i),this.init(),i.show(),this.$el.trigger("vcPanel.shown"),this.setSize(),this.$spinner.remove(),this.$content.scrollTop(0)}),this.setTitle(),this},ajaxData:function(){return{action:"vc_edit_form",tag:this.model.get("shortcode"),post_id:e("#post_ID").val(),params:this.model.get("params")}},init:function(){var t=this;e(".vc_shortcode-param",this.content()).each(function(){var i,a;i={},a=e(this),i=a.data("param_settings"),vc.atts.init.call(t,i,a)}),this.initDependency(),e(".wpb-edit-form .textarea_html").each(function(){window.init_textarea_html(e(this))}),this.panelInit=!0},initDependency:function(){var t={};_.each(this.mapped_params,function(i){if(_.isObject(i)&&_.isObject(i.dependency)){var a=i.dependency;if(_.isString(i.dependency.element)){var n,s;n=e("[name="+i.dependency.element+"].wpb_vc_param_value",this.$content),s=e("[name= "+i.param_name+"].wpb_vc_param_value",this.$content),_.each(n,function(i){var a,n;a=e(i),n=a.attr("name"),_.isArray(this.dependent_elements[a.attr("name")])||(this.dependent_elements[a.attr("name")]=[]),this.dependent_elements[a.attr("name")].push(s),!a.data("dependentSet")&&a.attr("data-dependent-set","true")&&a.bind("keyup change",this.hookDependent),t[n]||(t[n]=a)},this)}_.isString(a.callback)&&window[a.callback].call(this)}},this),this.doCheckTabs=!1,_.each(t,function(e){this.hookDependent({currentTarget:e})},this),this.doCheckTabs=!0,this.checkTabs(),t=null},hookDependent:function(t){var i,a,n,s,o,c;return i=e(t.currentTarget),a=i.closest(".vc_column"),s=this.dependent_elements[i.attr("name")],o=i.is(":checkbox")?_.map(this.$content.find("[name="+e(t.currentTarget).attr("name")+"].wpb_vc_param_value:checked"),function(t){return e(t).val()}):i.val(),c=!0&&this.doCheckTabs,this.doCheckTabs=!1,n=i.is(":checkbox")?!this.$content.find("[name="+i.attr("name")+"].wpb_vc_param_value:checked").length:!o.length,a.hasClass("vc_dependent-hidden")?_.each(s,function(e){var t=jQuery.Event("change");t.extra_type="vcHookDepended",e.closest(".vc_column").addClass("vc_dependent-hidden"),e.trigger(t)}):_.each(s,function(e){var t=e.attr("name"),i=_.isObject(this.mapped_params[t])&&_.isObject(this.mapped_params[t].dependency)?this.mapped_params[t].dependency:{},a=e.closest(".vc_column");_.isBoolean(i.not_empty)&&i.not_empty===!0&&!n?a.removeClass("vc_dependent-hidden"):_.isBoolean(i.is_empty)&&i.is_empty===!0&&n?a.removeClass("vc_dependent-hidden"):i.value&&_.intersection(_.isArray(i.value)?i.value:[i.value],_.isArray(o)?o:[o]).length?a.removeClass("vc_dependent-hidden"):i.value_not_equal_to&&!_.intersection(_.isArray(i.value_not_equal_to)?i.value_not_equal_to:[i.value_not_equal_to],_.isArray(o)?o:[o]).length?a.removeClass("vc_dependent-hidden"):a.addClass("vc_dependent-hidden");var s=jQuery.Event("change");s.extra_type="vcHookDepended",e.trigger(s)},this),c&&(this.checkTabs(),this.doCheckTabs=!0),this},checkTabs:function(){var t=this;this.tabsInit===!1&&(this.tabsInit=!0,this.$content.hasClass("vc_with-tabs")&&(this.$tabsMenu=this.$content.find(".vc_edit-form-tabs-menu"))),this.$tabsMenu&&(this.$content.find(".vc_edit-form-tab").each(function(i){var a=t.$tabsMenu.find('> [data-tab-index="'+i+'"]');e(this).find('.vc_shortcode-param:not(".vc_dependent-hidden")').length?a.hasClass("vc_dependent-hidden")&&(a.removeClass("vc_dependent-hidden").removeClass("vc_tab-color-animated").addClass("vc_tab-color-animated"),window.setTimeout(function(){a.removeClass("vc_tab-color-animated")},200)):a.addClass("vc_dependent-hidden")}),window.setTimeout(this.setTabsSize,100))},setTabsSize:function(){this.$tabsMenu.parents(".vc_with-tabs.vc_panel-body").css("margin-top",this.$tabsMenu.outerHeight())},setActive:function(){this.$el.prev().addClass("active")},window:function(){return window},getParams:function(){var e;return e=this.mapped_params,this.params=_.extend({},this.model.get("params")),_.each(e,function(e){var t;t=vc.atts.parseFrame.call(this,e),this.params[e.param_name]=t},this),_.each(vc.edit_form_callbacks,function(e){e.call(this)},this),this.params},content:function(){return this.$content},save:function(){if(this.panelInit){var e;e=_.extend({},vc.getDefaults(this.model.get("shortcode")),this.getParams()),this.model.save({params:e}),this.showMessage(window.sprintf(window.i18nLocale.inline_element_saved,vc.getMapped(this.model.get("shortcode")).name),"success"),!vc.frame_window&&this.hide()}},show:function(){e(window).bind("resize.vcPropertyPanel",this.setSize),this.$el.show(),this.draggable||this.initDraggable(),this.setSize(),this.fixElContainment()},hide:function(t){t&&t.preventDefault(),this.ajax&&this.ajax.abort(),this.ajax=!1,vc.active_panel=!1,e(window).unbind("resize.vcPropertyPanel"),this._killEditor(),this.$el.hide(),this.$el.find(".vc_properties-list").removeClass("vc_with-tabs").css("margin-top","auto"),this.$content.empty().html("")},setTitle:function(){return this.$el.find(".vc_panel-title").text(vc.getMapped(this.model.get("shortcode")).name+" "+window.i18nLocale.settings),this},_killEditor:function(){_.isUndefined(window.tinyMCE)||e("textarea.textarea_html",this.$el).each(function(){var t=e(this).attr("id");"4"===tinymce.majorVersion?window.tinyMCE.execCommand("mceRemoveEditor",!0,t):window.tinyMCE.execCommand("mceRemoveControl",!0,t)}),jQuery("body").off("click.wpcolorpicker")}}),vc.PostSettingsPanelView=vc.PanelView.extend({events:{"click [data-save=true]":"save","click [data-dismiss=panel]":"hide","click [data-transparent=panel]":"toggleOpacity","mouseover [data-transparent=panel]":"addOpacity","mouseout [data-transparent=panel]":"removeOpacity"},saved_css_data:"",saved_title:"",$title:!1,editor:!1,post_settings_editor:!1,initialize:function(){vc.$custom_css=e("#vc_post-custom-css"),this.saved_css_data=vc.$custom_css.val(),this.saved_title=vc.title,this.editor=new Vc_postSettingsEditor,this.$body=e("body"),_.bindAll(this,"setSize","fixElContainment")},render:function(){return this.$title=this.$el.find("#vc_page-title-field"),this.$title.val(vc.title),this.setEditor(),this},setEditor:function(){this.editor.setEditor(vc.$custom_css.val())},setSize:function(){this.editor.setSize()},save:function(){if(this.$title){var e=this.$title.val();e!=vc.title&&vc.frame.setTitle(e)}this.setAlertOnDataChange(),vc.$custom_css.val(this.editor.getValue()),vc.frame_window&&vc.frame_window.vc_iframe.loadCustomCss(vc.$custom_css.val()),vc.updateSettingsBadge(),this.showMessage(window.i18nLocale.css_updated,"success")},setAlertOnDataChange:function(){this.saved_css_data!==this.editor.getValue()?vc.setDataChanged():this.$title&&this.saved_title!==this.$title.val()&&vc.setDataChanged()}}),vc.PostSettingsPanelViewBackendEditor=vc.PostSettingsPanelView.extend({render:function(){return this.setEditor(),this},setAlertOnDataChange:function(){vc.saved_custom_css!==this.editor.getValue()&&window.tinymce&&(window.switchEditors.go("content","tmce"),window.setTimeout(function(){window.tinymce.get("content").isNotDirty=!1},1e3))},save:function(){vc.PostSettingsPanelViewBackendEditor.__super__.save.call(this),this.hide()}}),vc.TemplatesEditorPanelView=vc.PanelView.extend({events:{"click [data-dismiss=panel]":"hide","click [data-transparent=panel]":"toggleOpacity","mouseover [data-transparent=panel]":"addOpacity","mouseout [data-transparent=panel]":"removeOpacity","click .wpb_remove_template":"removeTemplate","click [data-template_id]":"loadTemplate","click [data-template_name]":"loadDefaultTemplate","click #vc_template-save":"saveTemplate"},render:function(){var t=e("#vc_tabs-templates");this.$name=e("#vc_template-name"),this.$list=e("#vc_template-list");var t=e("#vc_tabs-templates");return t.find(".vc_edit-form-tab-control").removeClass("vc_active").eq(0).addClass("vc_active"),t.find(".vc_edit-form-tab").removeClass("vc_active").eq(0).addClass("vc_active"),t.find(".vc_edit-form-link").click(function(i){i.preventDefault();var a=e(this);t.find(".vc_active").removeClass("vc_active"),a.parent().addClass("vc_active"),e(a.attr("href")).addClass("vc_active")}),this},removeTemplate:function(t){t&&t.preventDefault();var i=e(t.currentTarget),a=i.closest(".wpb_template_li").find("a").text(),n=confirm(window.i18nLocale.confirm_deleting_template.replace("{template_name}",a));n&&(i.closest(".wpb_template_li").remove(),this.$list.html(window.i18nLocale.loading),e.ajax({type:"POST",url:window.ajaxurl,data:{action:"wpb_delete_template",template_id:i.attr("rel"),vc_inline:!0},context:this}).done(function(e){this.$list.html(e)}))},loadTemplate:function(t){t&&t.preventDefault();var i=e(t.currentTarget);e.ajax({type:"POST",url:vc.frame_window.location.href,data:{action:"vc_frontend_template",template_id:i.data("template_id"),vc_inline:!0},context:this}).done(function(t){var i,a;_.each(e(t),function(e){if("vc_template-data"===e.id)try{a=JSON.parse(e.innerHTML)}catch(t){window.console&&window.console.error&&window.console.error(t,"catching template data error")}"vc_template-html"===e.id&&(i=e.innerHTML)}),i&&a&&vc.builder.buildFromTemplate(i,a),this.showMessage(window.i18nLocale.template_added,"success")})},ajaxData:function(e){return{action:"vc_frontend_default_template",template_name:e.data("template_name"),vc_inline:!0}},loadDefaultTemplate:function(t){t&&t.preventDefault();var i=e(t.currentTarget);e.ajax({type:"POST",url:vc.frame_window.location.href,data:this.ajaxData(i),context:this}).done(function(t){var i,a;_.each(e(t),function(e){if("vc_template-data"===e.id)try{a=JSON.parse(e.innerHTML)}catch(t){window.console&&window.console.error&&window.console.error(t,"catching template data error")}"vc_template-html"===e.id&&(i=e.innerHTML)}),i&&a&&vc.builder.buildFromTemplate(i,a),this.showMessage(window.i18nLocale.template_added,"success")})},saveTemplate:function(e){e.preventDefault();var t,i,a=this.$name.val();if(_.isString(a)&&a.length){if(i=this.getPostContent(),!i.trim().length)return this.showMessage(window.i18nLocale.template_is_empty,"error"),!1;t={action:"wpb_save_template",template:i,template_name:a,frontend:!0,vc_inline:!0},this.$name.val(""),this.showMessage(window.i18nLocale.template_save,"success"),this.reloadTemplateList(t)}else this.showMessage(window.i18nLocale.please_enter_templates_name,"error")},reloadTemplateList:function(e){this.$list.html(window.i18nLocale.loading).load(window.ajaxurl,e)},getPostContent:function(){return vc.builder.getContent()}}),vc.TemplatesEditorPanelViewBackendEditor=vc.TemplatesEditorPanelView.extend({ajaxData:function(e){return{action:"vc_backend_template",template_id:e.attr("data-template_id"),vc_inline:!0}},loadTemplate:function(t){t.preventDefault();var i=e(t.currentTarget);e.ajax({type:"POST",url:window.ajaxurl,data:this.ajaxData(i),context:this}).done(function(e){_.each(vc.filters.templates,function(t){e=t(e)}),vc.storage.append(e),vc.shortcodes.fetch({reset:!0}),this.showMessage(window.i18nLocale.template_added,"success")})},loadDefaultTemplate:function(t){t.preventDefault();var i=e(t.currentTarget);e.ajax({type:"POST",url:window.ajaxurl,data:{action:"vc_backend_default_template",template_name:i.attr("data-template_name"),vc_inline:!0},context:this}).done(function(e){_.each(vc.filters.templates,function(t){e=t(e)}),vc.storage.append(e),vc.shortcodes.fetch({reset:!0}),this.showMessage(window.i18nLocale.template_added,"success")})},getPostContent:function(){return vc.storage.getContent()}}),vc.TemplatesPanelViewBackend=vc.PanelView.extend({$name:!1,$list:!1,template_load_action:"vc_backend_load_template",save_template_action:"vc_save_template",delete_template_action:"vc_delete_template",appendedTemplateType:"my_templates",appendedTemplateCategory:"my_templates",appendedCategory:"my_templates",appendedClass:"my_templates",loadUrl:window.ajaxurl,events:e.extend(vc.PanelView.prototype.events,{"click .vc_template-save-btn":"saveTemplate","click [data-template_unique_id] [data-template-handler]":"loadTemplate","click .vc_template-delete-icon":"removeTemplate"}),initialize:function(){vc.TemplatesPanelViewBackend.__super__.initialize.call(this)},render:function(){return this.$el.css("left",(e(window).width()-this.$el.width())/2),this.$name=this.$el.find(".vc_panel-templates-name"),this.$list=this.$el.find(".vc_templates-list-my_templates"),vc.TemplatesPanelViewBackend.__super__.render.call(this)},saveTemplate:function(e){e.preventDefault();var t,i,a=this.$name.val();return _.isString(a)&&a.length?(i=this.getPostContent(),i.trim().length?(t={action:this.save_template_action,template:i,template_name:a,vc_inline:!0},this.$name.val(""),void this.reloadTemplateList(t)):(this.showMessage(window.i18nLocale.template_is_empty,"error"),!1)):(this.showMessage(window.i18nLocale.please_enter_templates_name,"error"),!1)},removeTemplate:function(t){t&&t.preventDefault();var i=e(t.target),a=i.parents(".vc_template"),n=a.find(".vc_template-display-title").text(),s=confirm(window.i18nLocale.confirm_deleting_template.replace("{template_name}",n));if(s){var o=a.data("template_unique_id");a.remove(),e.ajax({type:"POST",url:window.ajaxurl,data:{action:this.delete_template_action,template_id:o,vc_inline:!0},context:this}).done(function(){this.showMessage(window.i18nLocale.template_removed,"success")})}},reloadTemplateList:function(t){var i=this,a=e('<li class="vc_template vc_col-sm-4 vc_templates-template-type-'+this.appendedClass+'"></li>');a.load(window.ajaxurl,t,function(t){i.filter=!1,a.attr("data-category",i.appendedTemplateCategory),a.attr("data-template_unique_id",e(t).data("template_id")),a.attr("data-template_type",i.appendedTemplateType),i.showMessage(window.i18nLocale.template_save,"success"),i.$list.prepend(e(this))})},getPostContent:function(){return vc.shortcodes.stringify("template")},loadTemplate:function(t){t.preventDefault();var i=e(t.target).parents(".vc_template");e.ajax({type:"POST",url:this.loadUrl,data:{action:this.template_load_action,template_unique_id:i.data("template_unique_id"),template_type:i.data("template_type"),vc_inline:!0},context:this}).done(this.renderTemplate)},renderTemplate:function(e){var t,i;_.each(vc.filters.templates,function(t){e=t(e)}),t=vc.storage.parseContent({},e),i=!1,_.each(t,function(e){if(vc.shortcodes.create(e),!i){var t=vc.shortcodeHasIdParam(e.shortcode);t&&!_.isUndefined(e.params)&&!_.isUndefined(e.params[t.param_name])&&e.params[t.param_name].length>0&&(i=!0)}}),i?this.showMessage(window.i18nLocale.template_added_with_id,"error"):this.showMessage(window.i18nLocale.template_added,"success")}}),vc.TemplatesPanelViewFrontend=vc.TemplatesPanelViewBackend.extend({template_load_action:"vc_frontend_load_template",loadUrl:!1,initialize:function(){this.loadUrl=vc.$frame.attr("src"),vc.TemplatesPanelViewFrontend.__super__.initialize.call(this)},render:function(){return vc.TemplatesPanelViewFrontend.__super__.render.call(this)},renderTemplate:function(t){var i,a;_.each(e(t),function(e){if("vc_template-data"===e.id)try{a=JSON.parse(e.innerHTML)}catch(t){window.console&&window.console.error&&console.error(t)}"vc_template-html"===e.id&&(i=e.innerHTML)}),i&&a&&vc.builder.buildFromTemplate(i,a)?this.showMessage(window.i18nLocale.template_added_with_id,"error"):this.showMessage(window.i18nLocale.template_added,"success")}}),vc.RowLayoutEditorPanelView=vc.PanelView.extend({events:{"click [data-dismiss=panel]":"hide","click [data-transparent=panel]":"toggleOpacity","mouseover [data-transparent=panel]":"addOpacity","mouseout [data-transparent=panel]":"removeOpacity","click .vc_layout-btn":"setLayout","click #vc_row-layout-update":"updateFromInput"},_builder:!1,render:function(t){return this.$input=e("#vc_row-layout"),t&&(this.model=t),this.addCurrentLayout(),vc.column_trig_changes=!0,this},builder:function(){return this._builder||(this._builder=new vc.ShortcodesBuilder),this._builder},hide:function(e){e&&e.preventDefault(),vc.active_panel=!1,this.$el.hide(),vc.column_trig_changes=!1},addCurrentLayout:function(){vc.shortcodes.sort();var e=_.map(vc.shortcodes.where({parent_id:this.model.get("id")}),function(e){var t=e.getParam("width");return t?t:"1/1"},"",this).join(" + ");this.$input.val(e)},isBuildComplete:function(){return this.builder().isBuildComplete()},setLayout:function(t){if(t&&t.preventDefault(),!this.isBuildComplete())return!1;var i=e(t.currentTarget),a=i.attr("data-cells"),n=this.model.view.convertRowColumns(a,this.builder());this.$input.val(n.join(" + "))},updateFromInput:function(e){if(e&&e.preventDefault(),!this.isBuildComplete())return!1;var t,i=this.$input.val();(t=this.validateCellsList(i))!==!1?this.model.view.convertRowColumns(t,this.builder()):window.alert(window.i18nLocale.wrong_cells_layout)},validateCellsList:function(e){var t,i,a,n=[],s=e.replace(/\s/g,"").split("+"),o=_.reduce(_.map(s,function(e){if(e.match(/^[vc\_]{0,1}span\d{1,2}$/)){var s=vc_convert_column_span_size(e);return s===!1?1e3:(t=s.split(/\//),n.push(t[0]+""+t[1]),12*parseInt(t[0],10)/parseInt(t[1],10))}return e.match(/^[1-9]|1[0-2]\/[1-9]|1[0-2]$/)?(t=e.split(/\//),i=parseInt(t[0],10),a=parseInt(t[1],10),12%a!==0||i>a?1e3:(n.push(i+""+t[1]),12*i/a)):1e3}),function(e,t){return t+=e},0);return o>=1e3?!1:n.join("_")}}),vc.RowLayoutEditorPanelViewBackend=vc.RowLayoutEditorPanelView.extend({builder:function(){return this.builder||(this.builder=vc.storage),this.builder},isBuildComplete:function(){return!0},setLayout:function(t){t&&t.preventDefault();var i=e(t.currentTarget),a=i.attr("data-cells"),n=this.model.view.convertRowColumns(a);this.$input.val(n.join(" + "))}})}(window.jQuery);