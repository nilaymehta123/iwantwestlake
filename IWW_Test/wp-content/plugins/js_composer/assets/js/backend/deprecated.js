!function(e){_.isUndefined(window.vc)&&(window.vc={});var t=function(e,t){return e[0].classList.contains(t)};window.vc_get_column_size=function(e){return t(e,"vc_col-sm-12")?"1/1":t(e,"vc_col-sm-11")?"11/12":t(e,"vc_col-sm-10")?"4/6":t(e,"vc_col-sm-9")?"3/4":t(e,"vc_col-sm-8")?"5/6":t(e,"vc_col-sm-8")?"2/3":t(e,"vc_col-sm-7")?"7/12":t(e,"vc_col-sm-6")?"1/2":t(e,"vc_col-sm-5")?"5/12":t(e,"vc_col-sm-4")?"1/3":t(e,"vc_col-sm-3")?"1/4":t(e,"vc_col-sm-2")?"1/6":t(e,"vc_col-sm-1")?"1/12":!1};vc.post_custom_css_block_view=Backbone.View.extend({tagName:"div",className:"wpb_bootstrap_modals",template:_.template(e("#wpb-post-custom-css-modal-template").html()||"<div></div>"),events:{"click .wpb_save_edit_form":"save"},initialize:function(){},render:function(){e("div.wpb_bootstrap_modals").filter(function(){return"none"==e(this).css("display")}).remove(),this.$field=e("#wpb_custom_post_css_field"),e("body").append(this.$el.html(this.template())),e("#wpb_csseditor").html(this.$field.val()),this.$editor=ace.edit("wpb_csseditor");var t=this.$editor.getSession();t.setMode("ace/mode/css"),this.$editor.setValue(this.$field.val()),this.$editor.clearSelection(),this.$editor.focus();var i=t.getLength();this.$editor.gotoLine(i,t.getLine(i-1).length)},setSize:function(){var t=e(window).height()-250,i=e("#wpb_csseditor");i.css({height:t,minHeight:t})},save:function(){this.setAlertOnDataChange(),this.$field.val(this.$editor.getValue()),this.close()},show:function(){this.render(),e(window).bind("resize.vcPropertyPanel",this.setSize),this.setSize(),this.$el.modal("show")},close:function(){this.$el.modal("hide")},setAlertOnDataChange:function(){vc.saved_custom_css!==this.$editor.getValue()&&window.tinymce&&(window.switchEditors.go("content","tmce"),window.tinymce.get("content").isNotDirty=!1)}});vc.element_start_index=0;var i=(vc.add_templates_block_view=Backbone.View.extend({tagName:"div",className:"wpb_bootstrap_modals",template:_.template(e("#wpb-add-templates-modal-template").html()||"<div></div>"),events:{"click .close":"close",hidden:"removeView"},initialize:function(){},render:function(){return e("body").append(this.$el.html(this.template())),e("#vc_tabs-templates").tabs(),this.$name=e("#vc_template-name"),this.data_rendered=!0,this},removeView:function(){this.remove()},show:function(e){this.container=e,this.render(),this.$el.modal("show")},close:function(){this.$el.modal("hide")}}),vc.element_block_view=Backbone.View.extend({tagName:"div",className:"wpb_bootstrap_modals",template:_.template(e("#wpb-elements-list-modal-template").html()||"<div></div>"),data_saved:!1,events:{"click [data-element]":"createElement","click .close":"close",hidden:"removeView",shown:"setupShown","click .wpb-content-layouts-container .isotope-filter a":"filterElements","keyup #vc_elements_name_filter":"filterElements"},initialize:function(){_.isUndefined(this.model)&&(this.model={position_to_add:"end"})},render:function(){{var t,i,n,a;this.container.$content}e("body").append(this.$el.html(this.template())),i=this.$el.find(".wpb-elements-list"),t=".wpb-layout-element-button",n=this.container.model?this.container.model.get("shortcode"):"vc_column",a=this._getNotIn(n);var s=n&&!_.isUndefined(vc.map[n].as_parent)?vc.map[n].as_parent:!1;if(_.isObject(s)){var o=[];_.isString(s.only)&&o.push(_.reduce(s.only.replace(/\s/,"").split(","),function(e,t){return e+(_.isEmpty(e)?"":",")+'[data-element="'+t.trim()+'"]'},"")),_.isString(s.except)&&o.push(_.reduce(s.except.replace(/\s/,"").split(","),function(e,t){return e+':not([data-element="'+t.trim()+'"])'},"")),t+=o.join(",")}else a&&(t=a);return n===!1||n===!1||_.isUndefined(vc.map[n].allowed_container_element)||(vc.map[n].allowed_container_element===!1?t+=":not([data-is-container=true])":_.isString(vc.map[n].allowed_container_element)&&(t+=':not([data-is-container=true]), [data-element="'+vc.map[n].allowed_container_element+'"]')),e(".wpb-content-layouts",i).isotope({itemSelector:t,layoutMode:"fitRows",filter:null}),e(t,i).addClass("isotope-item"),e(".wpb-content-layouts",i).isotope("reloadItems"),e(".wpb-content-layouts-container .isotope-filter a:first",i).trigger("click"),e("[data-filter]",this.$el).each(function(){e(e(this).data("filter")+":visible",i).length?e(this).parent().show():e(this).parent().hide()}),this},_getNotIn:_.memoize(function(e){var t=_.reduce(vc.map,function(t,i){var n=_.isEmpty(t)?"":",";return _.isObject(i.as_child)?(_.isString(i.as_child.only)&&(_.contains(i.as_child.only.replace(/\s/,"").split(","),e)||(t+=n+'.wpb-layout-element-button:not([data-element="'+i.base+'"])')),_.isString(i.as_child.except)&&_.contains(i.as_child.except.replace(/\s/,"").split(","),e)&&(t+=n+'.wpb-layout-element-button:not([data-element="'+i.base+'"])')):i.as_child===!1&&(t+=n+'.wpb-layout-element-button:not([data-element="'+i.base+'"])'),t},"");return t}),filterElements:function(t){t.stopPropagation();var i=this.$el.find(".wpb-elements-list"),n=e(t.currentTarget),a="",s=e("#vc_elements_name_filter"),o=s.val();n.is("[data-filter]")?(e(".wpb-content-layouts-container .isotope-filter .active",i).removeClass("active"),n.parent().addClass("active"),a=n.data("filter"),s.val("")):o.length>0?(a=":containsi('"+o+"')",e(".wpb-content-layouts-container .isotope-filter .active",i).removeClass("active")):0==o.length&&e('.wpb-content-layouts-container .isotope-filter [data-filter="*"]').parent().addClass("active"),e(".wpb-content-layouts",i).isotope({filter:a})},createElement:function(t){var i,n,a;_.isObject(t)&&t.preventDefault();var s=e(t.currentTarget);this.container.$content.is("#visual_composer_content")?(a=Shortcodes.create({shortcode:"vc_row"}),n=Shortcodes.create({shortcode:"vc_column",params:{width:"1/1"},parent_id:a.id,root_id:a.id}),i="vc_row"!=s.data("element")?Shortcodes.create({shortcode:s.data("element"),parent_id:n.id,params:vc.getDefaults(s.data("element")),root_id:a.id}):a):"vc_row"==s.data("element")?(a=i=Shortcodes.create({shortcode:"vc_row_inner",parent_id:this.container.model.id,order:"start"==this.model.position_to_add?this.getFirstPositionIndex():Shortcodes.getNextOrder()}),Shortcodes.create({shortcode:"vc_column_inner",params:{width:"1/1"},parent_id:a.id,root_id:a.id})):i=Shortcodes.create({shortcode:s.data("element"),parent_id:this.container.model.id,order:"start"==this.model.position_to_add?this.getFirstPositionIndex():Shortcodes.getNextOrder(),params:vc.getDefaults(s.data("element")),root_id:this.container.model.get("root_id")}),this.selected_model=_.isBoolean(vc.map[s.data("element")].show_settings_on_create)&&vc.map[s.data("element")].show_settings_on_create===!1?!1:i,this.$el.modal("hide"),this.close()},getFirstPositionIndex:function(){return vc.element_start_index-=1,vc.element_start_index},removeView:function(){this.selected_model&&"vc_row"!=this.selected_model.get("shortcode")&&"vc_row_inner"!=this.selected_model.get("shortcode")&&(vc.edit_element_block_view=new i({model:this.selected_model}),vc.edit_element_block_view.show()),this.remove()},setupShown:function(){vc.is_mobile||e("#vc_elements_name_filter").focus()},show:function(t){this.container=t,this.render(),e(window).bind("resize.ModalView",this.setSize),this.setSize(),this.$el.modal("show")},close:function(){e(window).unbind("resize.ModalView"),this.$el.modal("hide")},setSize:function(){var t=e(window).height()-143;this.$el.find(".modal-body").css("maxHeight",t)}}),Backbone.View.extend({tagName:"div",className:"wpb_bootstrap_modals",template:_.template(e("#wpb-element-settings-modal-template").html()||"<div></div>"),textarea_html_checksum:"",dependent_elements:{},mapped_params:{},events:{"click .wpb_save_edit_form":"save",hidden:"remove",hide:"askSaveData",shown:"loadContent"},content:function(){return this.$content},window:function(){return window},initialize:function(){var e=this.model.get("shortcode"),t=_.isObject(vc.map[e])&&_.isArray(vc.map[e].params)?vc.map[e].params:[];_.bindAll(this,"hookDependent"),this.dependent_elements={},this.mapped_params={},_.each(t,function(e){this.mapped_params[e.param_name]=e},this)},render:function(){return e("body").append(this.$el.html(this.template())),this.$content=this.$el.find(".modal-body > div"),this},initDependency:function(){_.each(this.mapped_params,function(t){if(_.isObject(t)&&_.isObject(t.dependency)&&_.isString(t.dependency.element)){var i=e("[name="+t.dependency.element+"].wpb_vc_param_value",this.$content),n=e("[name= "+t.param_name+"].wpb_vc_param_value",this.$content);_.each(i,function(i){var a=e(i),s=t.dependency;_.isArray(this.dependent_elements[a.attr("name")])||(this.dependent_elements[a.attr("name")]=[]),this.dependent_elements[a.attr("name")].push(n),a.bind("keyup change",this.hookDependent),this.hookDependent({currentTarget:a},[n]),_.isString(s.callback)&&window[s.callback].call(this)},this)}},this)},hookDependent:function(t,i){var n,a,s=e(t.currentTarget),o=s.closest(".vc_row-fluid");return i=_.isArray(i)?i:this.dependent_elements[s.attr("name")],n=s.is(":checkbox")?_.map(this.$content.find("[name="+e(t.currentTarget).attr("name")+"].wpb_vc_param_value:checked"),function(t){return e(t).val()}):s.val(),a=s.is(":checkbox")?!this.$content.find("[name="+s.attr("name")+"].wpb_vc_param_value:checked").length:!n.length,o.hasClass("vc_dependent-hidden")?_.each(i,function(e){e.closest(".vc_row-fluid").addClass("vc_dependent-hidden")}):_.each(i,function(e){var t=e.attr("name"),i=_.isObject(this.mapped_params[t])&&_.isObject(this.mapped_params[t].dependency)?this.mapped_params[t].dependency:{},s=e.closest(".vc_row-fluid");_.isBoolean(i.not_empty)&&i.not_empty===!0&&!a?s.removeClass("vc_dependent-hidden"):_.isBoolean(i.is_empty)&&i.is_empty===!0&&a?s.removeClass("vc_dependent-hidden"):_.intersection(_.isArray(i.value)?i.value:[i.value],_.isArray(n)?n:[n]).length?s.removeClass("vc_dependent-hidden"):s.addClass("vc_dependent-hidden"),e.trigger("change")},this),this},loadContent:function(){e.ajax({type:"POST",url:window.ajaxurl,data:{action:"wpb_show_edit_form",element:this.model.get("shortcode"),post_id:e("#post_ID").val(),shortcode:store.createShortcodeString(this.model.toJSON())},context:this}).done(function(e){this.$content.html(e),this.$el.find("h3").text(this.$content.find("> [data-title]").data("title")),this.initDependency()})},save:function(e){_.isObject(e)&&e.preventDefault();var t=this.getParams();return this.model.save({params:t}),0===parseInt(Backbone.VERSION)&&this.model.trigger("change:params",this.model),this.data_saved=!0,this.close(),this},getParams:function(){var e=this.mapped_params;return this.params=jQuery.extend(!0,{},this.model.get("params")),_.each(e,function(e){this.params[e.param_name]=vc.atts.parse.call(this,e)},this),_.each(vc.edit_form_callbacks,function(e){e.call(this)},this),this.params},getCurrentParams:function(){var e=this.mapped_params,t=jQuery.extend(!0,{},this.model.get("params"));return _.each(e,function(e){_.isUndefined(t[e.param_name])&&(t[e.param_name]=""),"textarea_html"===e.type&&(t[e.param_name]=t[e.param_name].replace(/\n/g,""))},this),t},show:function(){this.render(),e(window).bind("resize.ModalView",this.setSize),this.setSize(),this.$el.modal("show")},_killEditor:function(){_.isUndefined(window.tinyMCE)||e("textarea.textarea_html",this.$el).each(function(){var t=e(this).attr("id");"4"===tinymce.majorVersion?window.tinyMCE.execCommand("mceRemoveEditor",!0,t):window.tinyMCE.execCommand("mceRemoveControl",!0,t)})},dataNotChanged:function(){var e=this.getCurrentParams(),t=this.getParams();return _.isEqual(e,t)},askSaveData:function(){return this.data_saved||this.dataNotChanged()||confirm(window.i18nLocale.if_close_data_lost)?(this._killEditor(),this.data_saved=!0,e(window).unbind("resize.ModalView"),!0):!1},close:function(){this.askSaveData()&&this.$el.modal("hide")},setSize:function(){var t=e(window).height()-250;this.$el.find(".modal-body").css("maxHeight",t)}}))}(window.jQuery);