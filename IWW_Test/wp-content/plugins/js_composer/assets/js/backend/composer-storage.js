!function(t){vc.debug=!1,vc.map=_.isUndefined(window.vc_mapper)?{}:window.vc_mapper,vc.roles=_.isUndefined(window.vc_roles)?{}:window.vc_roles,vc.Storage=function(){this.data={}},vc.Storage.prototype={url:window.ajaxurl,checksum:!1,locked:!1,create:function(t){return t.id||(t.id=t.attributes.id=vc_guid()),this.data[t.id]=t.toJSON(),this.setModelRoot(t.id),this.save(),t},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},setModelRoot:function(t){var n=this.data[t];_.isString(n.parent_id)&&_.isObject(this.data[n.parent_id])&&(n.root_id=this.data[n.parent_id].root_id),_.isObject(this.data[n.root_id])&&(this.data[n.root_id].html=!1)},update:function(t){return this.data[t.id]=t.toJSON(),this.setModelRoot(t.id),this.save(),t},destroy:function(t){return _.isUndefined(this.data[t.id])||_.isUndefined(this.data[t.id].root_id)||!_.isObject(this.data[this.data[t.id].root_id])||(this.data[this.data[t.id].root_id].html=!1),_.isUndefined(this.data[t.id])||delete this.data[t.id],this.save(),t},find:function(t){return this.data[t]},findAll:function(){return this.fetch(),_.values(this.data)},findAllRootSorted:function(){var t=_.filter(_.values(this.data),function(t){return t.parent_id===!1});return _.sortBy(t,function(t){return t.order})},escapeParam:function(t){return _.isString(t)?t.replace(/"/g,"``"):_.isUndefined(t)||_.isNull(t)||!t.toString?"":t.toString().replace(/"/g,"``")},unescapeParam:function(t){return t.replace(/(\`{2})/g,'"')},createShortcodeString:function(t){var n,e,i,o,r;return i=_.extend({},t.params),r=vc.getMergedParams(t.shortcode,i),o={},_.each(r,function(t,n){"content"!==n&&(o[n]=this.escapeParam(t))},this),n=this._getShortcodeContent(t),e=_.isObject(vc.map[t.shortcode])&&(_.isBoolean(vc.map[t.shortcode].is_container)&&!0===vc.map[t.shortcode].is_container||!_.isEmpty(vc.map[t.shortcode].as_parent)),wp.shortcode.string({tag:t.shortcode,attrs:o,content:n,type:!e&&_.isUndefined(vc.getParamSettings(t.shortcode,"content"))?"single":""})},save:function(){if(this.locked)return this.locked=!1,!1;var t=_.reduce(this.findAllRootSorted(),function(t,n){return n.html=this.createShortcodeString(n),t+n.html},"",this);return this.setContent(t),this.checksum=vc_globalHashCode(t),this},_getShortcodeContent:function(t){var n=this,e=_.sortBy(_.filter(this.data,function(n){return n.parent_id===t.id}),function(t){return t.order}),i={};return _.extend(i,t.params),e.length?_.reduce(e,function(t,e){return t+n.createShortcodeString(e)},""):(!_.isUndefined(window.switchEditors)&&_.isString(i.content)&&window.switchEditors.wpautop(i.content)===i.content&&(i.content=window.vc_wpautop(i.content)),_.isUndefined(i.content)?"":i.content)},getContent:function(){return _.isObject(window.tinymce)&&tinymce.editors.content&&tinymce.editors.content.save(),window.vc_wpnop(t("#content").val())},setContent:function(n){var e=_.isObject(window.tinymce)&&tinymce.editors.content&&!_.isUndefined(window.switchEditors),i=e&&window.tinyMCE.get("content")&&window.tinyMCE.get("content").isHidden();e&&window.switchEditors.go("content","html"),t("#content").val(n),e&&!i&&window.switchEditors.go("content","tmce")},parseContent:function(t,n,e){var i=_.keys(vc.map).join("|"),o=window.wp.shortcode.regexp(i),r=n.trim().match(o);return _.isNull(r)?t:(_.each(r,function(n){var o,r,c=n.match(this.regexp(i)),s=c[5],a=new RegExp("^[\\s]*\\[\\[?("+_.keys(vc.map).join("|")+")(?![\\w-])"),d=window.vc_guid(),h=window.wp.shortcode.attrs(c[3]),u={};_.each(h.named,function(t,n){u[n]=this.unescapeParam(t)},this),o={id:d,shortcode:c[2],order:this.order,params:_.extend({},u),parent_id:_.isObject(e)?e.id:!1,root_id:_.isObject(e)?e.root_id:d},r=vc.map[o.shortcode],this.order+=1,t[d]=o,d==o.root_id&&(t[d].html=n),_.isString(s)&&s.match(a)&&(_.isBoolean(r.is_container)&&r.is_container===!0||!_.isEmpty(r.as_parent)&&r.as_parent!==!1)?t=this.parseContent(t,s,t[d]):_.isString(s)&&s.length&&"vc_row"===c[2]?t=this.parseContent(t,'[vc_column width="1/1"][vc_column_text]'+s+"[/vc_column_text][/vc_column]",t[d]):_.isString(s)&&s.length&&"vc_column"===c[2]?t=this.parseContent(t,"[vc_column_text]"+s+"[/vc_column_text]",t[d]):_.isString(s)&&(t[d].params.content=s)},this),t)},isContentChanged:function(){return this.checksum===!1||this.checksum!==vc_globalHashCode(this.getContent())},wrapData:function(t){var n=_.keys(vc.map).join("|"),e=this.regexp_split("vc_row"),i=new RegExp("^\\[(\\[?)("+n+")","g"),o=_.filter(t.trim().split(e),function(t){return _.isEmpty(t)?void 0:t});return t=_.reduce(o,function(t,n){n.trim().match(i)||(n="[vc_row][vc_column][vc_column_text]"+n+"[/vc_column_text][/vc_column][/vc_row]");var e=n.match(vc_regexp_shortcode());return!_.isArray(e)||_.isUndefined(e[2])||_.isUndefined(vc.map[e[2]])||!_.isUndefined(vc.map[e[2]].is_container)&&vc.map[e[2]].is_container||!_.isEmpty(vc.map[e[2]].as_parent)||(n="[vc_row][vc_column]"+n+"[/vc_column][/vc_row]"),t+n},"")},fetch:function(){if(!this.isContentChanged())return this;this.order=0;var t=this.getContent();this.checksum=vc_globalHashCode(t),t=this.wrapData(t),this.data=this.parseContent({},t);try{}catch(n){this.data={}}},append:function(t){this.data={},this.order=0;try{var n=this.getContent();this.setContent(n+""+t)}catch(e){window.console&&window.console.error&&console.error(e)}},regexp_split:_.memoize(function(t){return new RegExp("(\\[(\\[?)["+t+"]+(?![\\w-])[^\\]\\/]*[\\/(?!\\])[^\\]\\/]*]?(?:\\/]\\]|\\](?:[^\\[]*(?:\\[(?!\\/"+t+"\\])[^\\[]*)*\\[\\/"+t+"\\])?)\\]?)","g")}),regexp:_.memoize(function(t){return new RegExp("\\[(\\[?)("+t+")(?![\\w-])([^\\]\\/]*(?:\\/(?!\\])[^\\]\\/]*)*?)(?:(\\/)\\]|\\](?:([^\\[]*(?:\\[(?!\\/\\2\\])[^\\[]*)*)(\\[\\/\\2\\]))?)(\\]?)")})},vc.storage=new vc.Storage}(window.jQuery);