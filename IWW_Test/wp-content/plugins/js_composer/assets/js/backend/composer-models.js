!function(){var e,t=vc.storage;vc.shortcode=Backbone.Model.extend({settings:!1,defaults:function(){var e=window.vc_guid();return{id:e,shortcode:"vc_text_block",order:vc.shortcodes.getNextOrder(),params:{},parent_id:!1,root_id:e,cloned:!1,html:!1,view:!1}},initialize:function(){this.bind("remove",this.removeChildren,this),this.bind("remove",this.removeEvents,this)},removeEvents:function(e){vc.events.triggerShortcodeEvents("destroy",e)},sync:function(e,n,r){var a;switch(e){case"read":a=n.id?t.find(n):t.findAll();break;case"create":a=t.create(n);break;case"update":a=t.update(n);break;case"delete":a=t.destroy(n)}a?r.success(a):r.error("Record not found")},getParam:function(e){return _.isObject(this.get("params"))&&!_.isUndefined(this.get("params")[e])?this.get("params")[e]:""},removeChildren:function(e){var t=vc.shortcodes.where({parent_id:e.id});_.each(t,function(e){vc.storage.lock(),e.destroy(),this.removeChildren(e)},this),t.length&&vc.storage.save()},setting:function(e){return this.settings===!1&&(this.settings=vc.getMapped(this.get("shortcode"))||{}),this.settings[e]}}),e=vc.shortcodes_collection=Backbone.Collection.extend({model:vc.shortcode,last_index:0,getNextOrder:function(){return this.last_index++},comparator:function(e){return e.get("order")},initialize:function(){},checkUpdateOrder:function(e){var t=e.get("order");t<this.length&&_.each(this.filter(function(n){return e.id!=n.id&&e.get("parent_id")===n.get("parent_id")&&n.get("order")>=t}),function(e){e.save({order:e.get("order")+1})})},createFromString:function(e,t){var n;n=vc.storage.parseContent({},e,_.isObject(t)?t.toJSON():!1),_.each(_.values(n),function(e){vc.shortcodes.create(e)},this)},sync:function(e,n,r){var a;switch(e){case"read":a=n.id?t.find(n):t.findAll();break;case"create":a=t.create(n);break;case"update":a=t.update(n);break;case"delete":a=t.destroy(n)}a?r.success(a):r.error("Record not found")},stringify:function(e){return this.modelsToString(_.sortBy(vc.shortcodes.where({parent_id:!1}),function(e){return e.get("order")}),e)},modelsToString:function(e,t){var n="";return _.each(e,function(e){var r,a,i,s,c,o;a=e.get("shortcode"),i=_.extend({},e.get("params")),o={},c=vc.getMergedParams(a,i),_.each(c,function(e,t){"content"!==t&&(o[t]=vc.storage.escapeParam(e))},this),s=_.isString(i.content)?i.content:"",s+=this.modelsToString(_.sortBy(vc.shortcodes.where({parent_id:e.get("id")}),function(e){return e.get("order")}),t),r={tag:a,attrs:o,content:s,type:_.isUndefined(vc.getParamSettings(a,"content"))&&!vc.getMapped(a).is_container?"single":""},_.isUndefined(t)?e.trigger("stringify",e,r):e.trigger("stringify:"+t,e,r),n+=wp.shortcode.string(r)},this),n}}),vc.shortcodes=new vc.shortcodes_collection,vc.getDefaults=vc.memoizeWrapper(function(e){var t,n;return t={},n=_.isObject(vc.map[e])&&_.isArray(vc.map[e].params)?vc.map[e].params:[],_.each(n,function(e){_.isObject(e)&&(_.isUndefined(e.std)?_.isUndefined(e.value)||(t[e.param_name]=vc.atts[e.type]&&vc.atts[e.type].defaults?vc.atts[e.type].defaults(e):_.isObject(e.value)?_.values(e.value)[0]:_.isArray(e.value)?e.value[0]:e.value):t[e.param_name]=e.std)}),t}),vc.getDefaultsAndDependencyMap=vc.memoizeWrapper(function(e){var t,n,r;return n={},t={},r=_.isObject(vc.map[e])&&_.isArray(vc.map[e].params)?vc.map[e].params:[],_.each(r,function(e){_.isObject(e)&&"content"!==e.param_name&&(_.isUndefined(e.std)?_.isUndefined(e.value)||(t[e.param_name]=vc.atts[e.type]&&vc.atts[e.type].defaults?vc.atts[e.type].defaults(e):_.isObject(e.value)?_.values(e.value)[0]:_.isArray(e.value)?e.value[0]:e.value):t[e.param_name]=e.std,_.isUndefined(e.dependency)||_.isUndefined(e.dependency.element)||(n[e.param_name]=e.dependency))}),{defaults:t,dependencyMap:n}}),vc.getMergedParams=function(e,t){var n,r,a;return n=vc.getDefaultsAndDependencyMap(e),r={},t=_.extend({},n.defaults,t),a=_.extend({},n.dependencyMap),_.each(t,function(i,s){if("content"!==s){var c;if(!_.isUndefined(a[s])){if(!_.isUndefined(a[a[s].element])&&_.isBoolean(a[a[s].element].failed)&&!0===a[a[s].element].failed)return void(a[s].failed=!0);var o,d,u,v;if(u=a[s].element,v=t[u],d=_.isEmpty(v),o=_.omit(a[s],"element"),_.isBoolean(o.not_empty)&&!0===o.not_empty&&d||_.isBoolean(o.is_empty)&&!0===o.is_empty&&!d||o.value&&!_.intersection(_.isArray(o.value)?o.value:[o.value],_.isArray(v)?v:[v]).length||o.value_not_equal_to&&_.intersection(_.isArray(o.value_not_equal_to)?o.value_not_equal_to:[o.value_not_equal_to],_.isArray(v)?v:[v]).length)return void(a[s].failed=!0)}c=vc.getParamSettings(e,s),_.isUndefined(c)?r[s]=i:(!_.isUndefined(n.defaults[s])&&n.defaults[s]!==i||_.isUndefined(n.defaults[s])&&""!==i||!_.isUndefined(c.save_always)&&!0===c.save_always)&&(r[s]=i)}}),r},vc.getParamSettings=vc.memoizeWrapper(function(e,t){var n,r;return n=_.isObject(vc.map[e])&&_.isArray(vc.map[e].params)?vc.map[e].params:[],r=_.find(n,function(e){return _.isObject(e)&&e.param_name===t},this)},function(){return arguments[0]+","+arguments[1]}),vc.getParamSettingsByType=vc.memoizeWrapper(function(e,t){var n,r;return n=_.isObject(vc.map[e])&&_.isArray(vc.map[e].params)?vc.map[e].params:[],r=_.find(n,function(e){return _.isObject(e)&&e.type===t},this)},function(){return arguments[0]+","+arguments[1]}),vc.shortcodeHasIdParam=vc.memoizeWrapper(function(e){return vc.getParamSettingsByType(e,"el_id")})}(window.jQuery);