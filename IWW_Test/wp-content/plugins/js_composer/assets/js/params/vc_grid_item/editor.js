!function(e){vc.gridItemEditor=!0,vc.Storage.prototype.getContent=function(){var t;return _.isObject(window.tinymce)&&tinymce.editors.content&&tinymce.editors.content.save(),t=window.vc_wpnop(e("#content").val()),t.length?t:vcDefaultGridItemContent},vc.visualComposerView.prototype.rowSortableSelector="> [data-element_type]",vc.visualComposerView.prototype.events={"click #vc_templates-editor-button":"openTemplatesWindow",'click [data-vc-navbar-control="edit"]':"openVcGitemEditForm",'click [data-vc-navbar-control="preview"]':"renderGitemPreview",'change [data-vc-navbar-control="preview_width"]':"setPreviewItemWidth","click #wpb-save-post":"save",'change [data-vc-navbar-control="animation"]':"changeAnimation"},vc.visualComposerView.previewActivated=!1,vc.visualComposerView.prototype.renderGitemPreview=function(e){e&&e.preventDefault(),this.previewActivated?this.hidePreview():(vc.showSpinner(),this.sendDataGitemPreview())},vc.visualComposerView.prototype.sendDataGitemPreview=function(){var t;e('[data-vc-grid-item="preview"]').html('<iframe name="vc_gitem-preview-iframe"></iframe>').addClass("vc_visible"),t=e('<form id="vc_gitem-preview-form" action="'+encodeURI(ajaxurl)+'" method="post" target="vc_gitem-preview-iframe" style="position: absolute;visibility: hidden;right: 0; bottom:0"><input type="hidden" name="action" value="vc_gitem_preview"><input type="hidden" id="vc_gitem-preview-form-shortcode-string" name="shortcodes_string"><input type="hidden" name="post_id"><input type="submit" name="submit">').prependTo("body"),t.find('[name="post_id"]').val(e("#post_ID").val()),t.find('[name="shortcodes_string"]').val(vc.storage.getContent()),t.find('[type="submit"]').trigger("click"),t.remove()},vc.visualComposerView.prototype.showPreview=function(t){e("#visual_composer_content").hide(),e('[data-vc-grid-item="preview"]').addClass("vc_visible"),_.isString(t)&&e('[data-vc-grid-item="navbar_preview_width"] select').val(t),e('[data-vc-grid-item="navbar_preview_width"]').addClass("vc_visible"),vc.hideSpinner(),e('[data-vc-navbar-control="preview"]').text(i18nLocaleGItem.builder),this.previewActivated=!0},vc.visualComposerView.prototype.hidePreview=function(){e("#visual_composer_content").show(),e('[data-vc-grid-item="preview"]').removeClass("vc_visible").html(""),e('[data-vc-grid-item="navbar_preview_width"]').removeClass("vc_visible"),this.previewActivated=!1,e('[data-vc-navbar-control="preview"]').text(i18nLocaleGItem.preview)},vc.visualComposerView.prototype.setPreviewItemWidth=function(t){var i=e("#vc_gitem-preview iframe").get(0).contentWindow;_.isString(t)?e('[data-vc-grid-item="navbar_preview_width"] select').val(t):t&&t.currentTarget&&i.vcSetItemWidth(e(t.currentTarget).val())},vc.visualComposerView.prototype.openVcGitemEditForm=function(e){e&&e.preventDefault();var t=vc.shortcodes.findWhere({shortcode:"vc_gitem"});this.previewActivated&&this.hidePreview(),t&&vc.edit_element_block_view.render(t)},vc.visualComposerView.prototype.setSortable=function(){return e(".wpb_column_container").sortable({forcePlaceholderSize:!0,forceHelperSize:!1,connectWith:".wpb_column_container",placeholder:"vc_placeholder",items:"> .wpb_sortable.wpb_content_element",helper:this.renderPlaceholder,distance:3,scroll:!0,scrollSensitivity:70,cursor:"move",cursorAt:{top:20,left:16},tolerance:"intersect",start:function(){e("#visual_composer_content").addClass("vc_sorting-started"),e(".vc_not_inner_content").addClass("dragging_in")},stop:function(t,i){e("#visual_composer_content").removeClass("vc_sorting-started"),e(".dragging_in").removeClass("dragging_in");var o=i.item.data("element_type"),a=i.item.parent().closest("[data-element_type]").data("element_type"),n=_.isUndefined(vc.map[a].allowed_container_element)?!0:vc.map[a].allowed_container_element;vc.check_relevance(a,o)||e(this).sortable("cancel");var c=_.isObject(vc.map[o])&&(_.isBoolean(vc.map[o].is_container)&&vc.map[o].is_container===!0||!_.isEmpty(vc.map[o].as_parent));c&&n!==!0&&n!==i.item.data("element_type").replace(/_inner$/,"")&&e(this).sortable("cancel"),e(".vc_sorting-empty-container").removeClass("vc_sorting-empty-container")},update:this.updateElementsSorting,over:function(e,t){var i=t.item.data("element_type"),o=t.placeholder.closest("[data-element_type]").data("element_type"),a=_.isUndefined(vc.map[o].allowed_container_element)?!0:vc.map[o].allowed_container_element;if(!vc.check_relevance(o,i))return t.placeholder.addClass("vc_hidden-placeholder"),!1;var n=_.isObject(vc.map[i])&&(_.isBoolean(vc.map[i].is_container)&&vc.map[i].is_container===!0||!_.isEmpty(vc.map[i].as_parent));return n&&a!==!0&&a!==t.item.data("element_type").replace(/_inner$/,"")?(t.placeholder.addClass("vc_hidden-placeholder"),!1):(t.sender&&t.sender.length&&!t.sender.find("[data-element_type]:visible").length&&t.sender.addClass("vc_sorting-empty-container"),t.placeholder.removeClass("vc_hidden-placeholder"),void t.placeholder.css({maxWidth:t.placeholder.parent().width()}))}}),this},vc.visualComposerView.prototype.changeAnimation=function(t){var i,o,a;return(a=vc.shortcodes.findWhere({shortcode:"vc_gitem_animated_block"}))?(i=e(t.currentTarget),o=e.extend({},a.get("params")),o.animation=i.val(),a.save({params:o}),void(this.previewActivated&&this.changePreviewAnimation(o.animation))):!1},vc.visualComposerView.prototype.changePreviewAnimation=function(t){var i=e("#vc_gitem-preview iframe").get(0).contentWindow;i&&i.changeAnimation(t)},vc.AddElementBlockViewBackendEditor.prototype.createElement=function(t){var i,o,a,n,c,s=!1;this.do_render=!0,_.isObject(t)&&t.preventDefault(),o=e(t.currentTarget).data("tag"),!1!==this.model&&"vc_gitem_add_c_zone"===this.model.get("shortcode")?(this.model.view.setCZonePosition(this.model.getParam("position")),vc.storage.lock(),a=vc.shortcodes.create({shortcode:"vc_gitem_zone_c",parent_id:this.model.get("parent_id"),params:_.extend({},vc.getDefaults("vc_gitem_zone_c")),order:this.model.getParam("cZonePosition")}),this.model.view.cZone=a,vc.storage.lock(),n=vc.shortcodes.create({shortcode:"vc_gitem_row",params:_.extend({},vc.getDefaults("vc_gitem_row")),parent_id:a.get("id")}),vc.storage.lock(),c=vc.shortcodes.create({shortcode:"vc_gitem_col",params:_.extend({width:"1/1"},vc.getDefaults("vc_gitem_col")),parent_id:n.get("id")}),s=c.get("id"),a=null,c=null):!1!==this.model&&(s=this.model.get("id")),i=vc.shortcodes.create({shortcode:o,parent_id:s,params:vc.getDefaults(o),root_id:vc.shortcodes.findWhere({shortcode:"vc_gitem"})||!1}),"vc_gitem_row"===o&&vc.shortcodes.create({shortcode:"vc_gitem_col",params:{width:"1/1"},parent_id:i.get("id"),root_id:i.get("id")}),this.show_settings=_.isBoolean(vc.getMapped(o).show_settings_on_create)&&vc.getMapped(o).show_settings_on_create===!1?!1:!0,this.model=i,this.$el.modal("hide")},vc.EditElementPanelView.prototype.ajaxData=function(){return{action:"vc_edit_form",vc_grid_item_editor:"true",tag:this.model.get("shortcode"),post_id:e("#post_ID").val(),params:this.model.get("params")}},window.VcGitemView=window.VcColumnView.extend({animatedBlock:!1,cZone:!1,events:{'click > .vc_controls [data-vc-control="delete"]':"deleteShortcode",'click > .vc_controls [data-vc-control="add"]':"addElement",'click > .vc_controls [data-vc-control="edit"]':"editElement",'click > .vc_controls [data-vc-control="clone"]':"clone",'click [data-vc-gitem="add-c"]':"addCZone",'click > .vc_empty [data-vc-gitem="add-ab"]':"addAnimatedBlock"},initialize:function(e){window.VcColumnView.__super__.initialize.call(this,e),vc.shortcodes.on("all",this.setCZoneHeight)},setContent:function(){this.$content=this.$el.find("> .vc_gitem-content"),_.bindAll(this,"savePositionC","startCDragging","stopCDragging")},setCEmpty:function(){this.$content.addClass("vc_empty-c")},unsetCEmpty:function(){this.$content.removeClass("vc_empty-c")},setEmpty:function(){this.$content.addClass("vc_empty")},unsetEmpty:function(){this.$content.removeClass("vc_empty")},checkIsEmpty:function(){vc.shortcodes.where({parent_id:this.model.id,shortcode:"vc_gitem_zone_c"}).length?this.unsetCEmpty():this.setCEmpty(),vc.shortcodes.where({parent_id:this.model["if"],shortcode:"vc_gitem_animated_block"}).length?this.unsetEmpty():this.setEmpty(),window.VcColumnView.__super__.checkIsEmpty.call(this)},addAnimatedBlock:function(e){var t;e&&e.preventDefault(),this.animatedBlock||(vc.storage.lock(),t=vc.shortcodes.create({shortcode:"vc_gitem_animated_block",parent_id:this.model.get("id"),order:1,params:vc.getDefaults("vc_gitem_animated_block"),root_id:this.model.get("id")}),vc.storage.lock(),t.view.addZone("a"),t.view.addZone("b"))},addCZone:function(t){var i,o=e(t.currentTarget),a=o.data("vcPosition");return this.cZone?(this.updateCZonePosition(o,a),!1):(i=new vc.shortcode({shortcode:"vc_gitem_add_c_zone",params:{cZonePosition:this.getCZoneModelOrder(a),position:a},parent_id:this.model.get("id")}),i.view=this,void vc.add_element_block_view.render(i))},updateCZonePosition:function(e,t){this.setCZonePosition(t),this.setCZoneOrder(t),this.changeCZonePosition(e),this.setCssPosition(e)},setCZoneOrder:function(e){this.cZone.save({order:this.getCZoneModelOrder(e)})},changeCZonePosition:function(e){this.cZone.view.$el.appendTo(e)},setCZonePosition:function(e){this.model.save({params:_.extend({},this.model.get("params")||{},{c_zone_position:e})})},setCZoneHeight:function(){var t,i=e('[data-vc-gitem="add-c"][data-vc-position="left"]'),o=e('[data-element_type="vc_gitem_animated_block"]'),a=e('[data-vc-gitem="add-c"][data-vc-position="right"]');i.height("auto"),a.height("auto"),t=Math.max(i.height(),o.height(),a.height()),i.css("height",t),a.css("height",t)},getCZoneModelOrder:function(e){var t=this.animatedBlock.get("order");return"top"===e||"left"===e?t-1:t+1},cZoneRemoved:function(){this.cZone=!1,this.$content.find(".vc_zone-added").removeClass("vc_zone-added"),this.setCZonePosition("")},setDraggableC:function(){this.$content.find('[data-vc-gitem="add-c"]').sortable({items:'[data-element_type="vc_gitem_zone_c"]',connectWith:'[data-vc-gitem="add-c"]',forcePlaceholderSize:!0,forceHelperSize:!1,placeholder:"vc_placeholder",update:this.savePositionC,start:this.startCDragging,stop:this.stopCDragging}).disableSelection()},startCDragging:function(){this.$el.addClass("vc_sorting")},stopCDragging:function(){this.$el.removeClass("vc_sorting")},savePositionC:function(e,t){var i=t.item.parent(),o=i.data("vcPosition")||"bottom";vc.storage.lock(),this.cZone&&this.cZone.save({order:this.getCZoneModelOrder(o)}),this.setCZonePosition(o),this.setCssPosition(i)},setCssPosition:function(e){this.$content.find('[data-vc-gitem="add-c"].vc_zone-added').removeClass("vc_zone-added"),e.addClass("vc_zone-added")},addShortcode:function(t){var i,o,a=t.model.get("shortcode");t.render(),"vc_gitem_zone_c"===a?(i=this.model.getParam("c_zone_position")||"bottom",o=this.$content.find('[data-vc-gitem="add-c"][data-vc-position="'+i+'"]'),t.$el.appendTo(o.addClass("vc_zone-added")),this.setDraggableC(),this.cZone=t.model):"vc_gitem_animated_block"===a&&(t.$el.appendTo(e('[data-vc-gitem="add-ab"]')),this.animatedBlock=t.model)}}),window.VcGitemAnimatedBlockView=window.VcColumnView.extend({aZone:!1,bZone:!1,currentAnimation:"",events:{'click > .vc_controls [data-vc-control="delete"]':"deleteShortcode",'click > .vc_controls [data-vc-control="add"]':"addElement",'click > .vc_controls [data-vc-control="edit"]':"editElement",'click > .vc_controls [data-vc-control="clone"]':"clone",'click > .vc_empty-a [data-vc-gitem-animated-block="add-a"]':"addAZone",'click > .vc_empty-b [data-vc-gitem-animated-block="add-b"]':"addBZone","click > .vc_gitem-animated-block-content [data-vc-gitem-tab-link]":"activateZone",'click > .vc_gitem-animated-block-content [data-vc-control="edit"]':"showEditForm"},render:function(){var t;return window.VcGitemAnimatedBlockView.__super__.render.call(this),t=this.model.getParam("animation"),t&&e('[data-vc-navbar-control="animation"]').val(t),this},setContent:function(){this.$content=this.$el.find("> .vc_gitem-animated-block-content")},buildDesignHelpers:function(){window.VcGitemAnimatedBlockView.__super__.buildDesignHelpers.call(this),this.setAnimationDropDown(),this.setAnimationClassToBlock()},changeShortcodeParams:function(e){window.VcGitemAnimatedBlockView.__super__.changeShortcodeParams.call(this,e)},setAnimationClassToBlock:function(){var e=this.model.getParam("animation")||"single";this.currentAnimation&&this.$el.removeClass("vc_gitem-animation-"+this.currentAnimation),this.$el.addClass("vc_gitem-animation vc_gitem-animation-"+e),this.currentAnimation=e},setAnimationDropDown:function(){var t=this.model.getParam("animation");t&&e('[data-vc-gitem-animated-block="animation-dropdown"]').val(t),""===t&&this.activateZone({currentTarget:e(".vc_gitem-tab-a").get(0)})},addAZone:function(e){e&&e.preventDefault(),this.addZone("a")},addBZone:function(e){e&&e.preventDefault(),this.addZone("b")},addZone:function(e){this[e+"Zone"]||vc.shortcodes.create({shortcode:"vc_gitem_zone_"+e,parent_id:this.model.get("id"),params:vc.getDefaults("vc_gitem_zone_"+e)})},addTab:function(t,i){var o=e('<li class="vc_gitem-animated-block-tab vc_gitem-tab-'+t+'"><a href="#" data-vc-gitem-tab-link="'+t+'"><span class="vc_label">'+this.getZoneLabel(t)+'</span></a><a class="vc_control column_edit" data-vc-control="edit" data-vc-zone-model-id="'+i+'"><span class="vc_icon"></span></a></li>');o.appendTo('[data-vc-gitem-animated-block="tabs"]'),"a"===t&&this.switchZone(o.find("a"))},getZoneLabel:function(e){var t=vc.map["vc_gitem_zone_"+e]?vc.map["vc_gitem_zone_"+e]:!1;return t&&t.name?t.name:e},activateZone:function(t){var i=e(t.currentTarget);t&&t.preventDefault&&t.preventDefault(),!i.hasClass("vc_active")&&this.switchZone(i)},showEditForm:function(t){var i;t&&t.preventDefault(),i=e(t.currentTarget).data("vcZoneModelId"),i&&vc.app.views[i]&&vc.app.views[i].editElement()},switchZone:function(e){this.$el.find('[data-vc-gitem-animated-block="tabs"] .vc_active, [data-vc-gitem-animated-block].vc_active').removeClass("vc_active"),e.parent().addClass("vc_active"),this.$el.find('[data-vc-gitem-animated-block="add-'+e.data("vcGitemTabLink")+'"]').addClass("vc_active")},setAEmpty:function(){this.$content.addClass("vc_empty-a")},unsetAEmpty:function(){this.$content.removeClass("vc_empty-a")},setBEmpty:function(){this.$content.addClass("vc_empty-b")},unsetBEmpty:function(){this.$content.removeClass("vc_empty-b")},setEmpty:function(){this.setAEmpty(),this.setBEmpty()},checkIsEmpty:function(){vc.shortcodes.where({parent_id:this.model.get("id"),shortcode:"vc_gitem_zone_a"}).length?this.unsetAEmpty():this.setAEmpty(),vc.shortcodes.where({parent_id:this.model.get("id"),shortcode:"vc_gitem_zone_b"}).length?this.unsetBEmpty():this.setBEmpty()},addShortcode:function(e){var t=e.model.get("shortcode");e.render(),"vc_gitem_zone_a"===t?(e.$el.appendTo(this.$el.find('[data-vc-gitem-animated-block="add-a"]')),this.aZone=e.model,this.addTab("a",e.model.get("id"))):"vc_gitem_zone_b"===t&&(e.$el.appendTo(this.$el.find('[data-vc-gitem-animated-block="add-b"]')),this.bZone=e.model,this.addTab("b",e.model.get("id")))}}),window.VcGitemZoneView=window.VcColumnView.extend({addElement:function(e){var t;e&&e.preventDefault(),vc.storage.lock(),t=vc.shortcodes.create({shortcode:"vc_gitem_row",params:_.extend({},vc.getDefaults("vc_gitem_row")),parent_id:this.model.get("id")}),vc.shortcodes.create({shortcode:"vc_gitem_col",params:_.extend({width:"1/1"},vc.getDefaults("vc_gitem_col")),parent_id:t.get("id")})},buildDesignHelpers:function(){var t,i,o,a=this.model.getParam("css"),n=this.$el.find("> .vc_controls").get(0);t=this.model.getParam("featured_image"),this.$el.find('> [data-vc-helper="color"]').remove(),this.$el.find('> [data-vc-helper="image"]').remove(),this.$el.find('> [data-vc-helper="image-featured"]').remove();var c=a.match(/background\-image:\s*url\(([^\)]+)\)/);c&&!_.isUndefined(c[1])&&(i=c[1]);var c=a.match(/background\-color:\s*([^\s\;]+)\b/);c&&!_.isUndefined(c[1])&&(o=c[1]);var c=a.match(/background:\s*([^\s]+)\b\s*url\(([^\)]+)\)/);c&&!_.isUndefined(c[1])&&(o=c[1],i=c[2]),i&&e('<span class="vc_css-helper vc_image-helper" data-vc-helper="image" style="background-image: url('+i+');" title="'+i18nLocale.column_background_image+'"></span>').insertBefore(n),o&&e('<span class="vc_css-helper vc_color-helper" data-vc-helper="color" style="background-color: '+o+'" title="'+i18nLocale.column_background_color+'"></span>').insertBefore(n),"yes"===t&&e('<span class="vc_css-helper vc_featured" data-vc-helper="image-featured"></span>').insertBefore(n)}}),window.VcGitemZoneCView=window.VcGitemZoneView.extend({removeView:function(){window.VcGitemZoneCView.__super__.removeView.call(this);var e=vc.shortcodes.get(this.model.get("parent_id"));e&&vc.app.views[e.get("id")]&&vc.app.views[e.get("id")].cZoneRemoved()}}),window.VcGitemRowView=window.VcRowView.extend({zone:"",sortingSelector:"> [data-element_type=vc_gitem_col]",getChildTag:function(){return"vc_gitem_col"},addElement:function(e){e&&e.preventDefault(),vc.shortcodes.create({shortcode:this.getChildTag(),params:{},parent_id:this.model.id}),this.setActiveLayoutButton()},buildDesignHelpers:function(){}}),window.VcGitemColView=window.VcColumnView.extend({events:{'click > .vc_controls [data-vc-control="delete"]':"deleteShortcode",'click > .vc_controls [data-vc-control="add"]':"addElement",'click > .vc_controls [data-vc-control="edit"]':"editElement",'click > .vc_controls [data-vc-control="clone"]':"clone","click > .vc_controls [data-vc-align]":"changeTextAlign","click > .wpb_element_wrapper > .vc_empty-container":"addToEmpty"},designHelpersSelector:"> .vc_controls .column_edit",changeTextAlign:function(t){var i;if(t){if(t.preventDefault(),i=e(t.currentTarget),i.hasClass("vc_active"))return!1;i.parent().find(".vc_active").removeClass("vc_active"),i.addClass("vc_active"),_.defer(this.setTextAlign,i.data("vcAlign")||"left")}else this.$el.find('> .vc_controls [data-vc-align="'+(this.model.getParam("align")||"left")+'"]').addClass("vc_active")},setTextAlign:function(e){var t=_.extend({},this.model.get("params"),{align:e});this.model.save({params:t})},render:function(){return _.bindAll(this,"setTextAlign"),window.VcGitemColView.__super__.render.call(this),this.changeTextAlign(void 0),this}}),vc.TemplatesPanelViewBackend.prototype.renderTemplate=function(e){_.each(vc.filters.templates,function(t){e=t(e)}),vc.storage.setContent(e),vc.shortcodes.fetch({reset:!0}),this.hide()},e(document).ready(function(){e('[name="screen_columns"][value="1"]').trigger("click"),e("#screen-meta-links, #screen-meta").hide()})}(window.jQuery);