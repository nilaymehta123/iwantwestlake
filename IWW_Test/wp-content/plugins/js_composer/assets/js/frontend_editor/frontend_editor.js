function vc_guid(){return VCS4()+VCS4()+"-"+VCS4()}function VCS4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}if(_.isUndefined(window.vc))var vc={};_.extend(vc,{no_title_placeholder:window.i18nLocale.no_title_parenthesis,responsive_disabled:!1,template_options:{evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g},post_id:"",activity:!1,clone_index:1,loaded:!1,path:"",admin_ajax:window.ajaxurl,filters:{templates:[]},title:"",$title:!1,update_title:!1,$hold_active:!1,data_changed:!1,setDataChanged:function(){window.jQuery(window).bind("beforeunload.vcSave",function(){return window.i18nLocale.confirm_to_leave}),this.data_changed=!0},unsetDataChanged:function(){window.jQuery(window).unbind("beforeunload.vcSave"),this.data_changed=!1},addTemplateFilter:function(e){_.isFunction(e)&&this.filters.templates.push(e)},unsetHoldActive:function(){this.$hold_active&&(this.$hold_active.removeClass("vc_hold-active"),this.$hold_active=!1)}}),function(e){"use strict";vc.map={},vc.setFrameSize=function(t){var n=e("#vc_navbar"),a=e(window).height()-n.height();vc.$frame.width(t),vc.$frame_wrapper.css({top:n.height()}),vc.$frame.height(a)},vc.getDefaults=vc.memoizeWrapper(function(e){var t,n;return t={},n=_.isArray(vc.getMapped(e).params)?vc.getMapped(e).params:[],_.each(n,function(e){_.isObject(e)&&(_.isUndefined(e.std)?_.isUndefined(e.value)||(t[e.param_name]=vc.atts[e.type]&&vc.atts[e.type].defaults?vc.atts[e.type].defaults(e):!_.isObject(e.value)||_.isArray(e.value)||_.isString(e.value)?_.isArray(e.value)?e.value[0]:e.value:_.values(e.value)[0]):t[e.param_name]=e.std)}),t}),vc.getDefaultsAndDependencyMap=vc.memoizeWrapper(function(e){var t,n,a;return n={},t={},a=_.isArray(vc.getMapped(e).params)?vc.getMapped(e).params:[],_.each(a,function(e){_.isObject(e)&&"content"!==e.param_name&&(_.isUndefined(e.std)?_.isUndefined(e.value)||(t[e.param_name]=vc.atts[e.type]&&vc.atts[e.type].defaults?vc.atts[e.type].defaults(e):_.isObject(e.value)?_.values(e.value)[0]:_.isArray(e.value)?e.value[0]:e.value):t[e.param_name]=e.std,_.isUndefined(e.dependency)||_.isUndefined(e.dependency.element)||(n[e.param_name]=e.dependency))}),{defaults:t,dependencyMap:n}}),vc.getMergedParams=function(e,t){var n,a,i;return n=vc.getDefaultsAndDependencyMap(e),a={},t=_.extend({},n.defaults,t),i=_.extend({},n.dependencyMap),_.each(t,function(o,c){if("content"!==c){var r;if(!_.isUndefined(i[c])){if(!_.isUndefined(i[i[c].element])&&_.isBoolean(i[i[c].element].failed)&&!0===i[i[c].element].failed)return void(i[c].failed=!0);var s,d,l,v;if(l=i[c].element,v=t[l],d=_.isEmpty(v),s=_.omit(i[c],"element"),_.isBoolean(s.not_empty)&&!0===s.not_empty&&d||_.isBoolean(s.is_empty)&&!0===s.is_empty&&!d||s.value&&!_.intersection(_.isArray(s.value)?s.value:[s.value],_.isArray(v)?v:[v]).length||s.value_not_equal_to&&_.intersection(_.isArray(s.value_not_equal_to)?s.value_not_equal_to:[s.value_not_equal_to],_.isArray(v)?v:[v]).length)return void(i[c].failed=!0)}r=vc.getParamSettings(e,c),_.isUndefined(r)?a[c]=o:(!_.isUndefined(n.defaults[c])&&n.defaults[c]!==o||_.isUndefined(n.defaults[c])&&""!==o||!_.isUndefined(r.save_always)&&!0===r.save_always)&&(a[c]=o)}}),a},vc.getParamSettings=vc.memoizeWrapper(function(e,t){var n,a;return n=_.isArray(vc.getMapped(e).params)?vc.getMapped(e).params:[],a=_.find(n,function(e){return _.isObject(e)&&e.param_name===t},this)},function(){return arguments[0]+","+arguments[1]}),vc.getParamSettingsByType=vc.memoizeWrapper(function(e,t){var n,a;return n=_.isArray(vc.getMapped(e).params)?vc.getMapped(e).params:[],a=_.find(n,function(e){return _.isObject(e)&&e.type===t},this)},function(){return arguments[0]+","+arguments[1]}),vc.shortcodeHasIdParam=vc.memoizeWrapper(function(e){return vc.getParamSettingsByType(e,"el_id")}),vc.buildRelevance=function(){vc.shortcode_relevance={},_.each(vc.map,function(e){_.isObject(e.as_parent)&&_.isString(e.as_parent.only)&&(vc.shortcode_relevance["parent_only_"+e.base]=e.as_parent.only.replace(/\s/,"").split(",")),_.isObject(e.as_parent)&&_.isString(e.as_parent.except)&&(vc.shortcode_relevance["parent_except_"+e.base]=e.as_parent.except.replace(/\s/,"").split(",")),_.isObject(e.as_child)&&_.isString(e.as_child.only)&&(vc.shortcode_relevance["child_only_"+e.base]=e.as_child.only.replace(/\s/,"").split(",")),_.isObject(e.as_child)&&_.isString(e.as_child.except)&&(vc.shortcode_relevance["child_except_"+e.base]=e.as_child.except.replace(/\s/,"").split(","))}),vc.checkRelevance=function(e,t){return _.isArray(vc.shortcode_relevance["parent_only_"+e])&&!_.contains(vc.shortcode_relevance["parent_only_"+e],t)?!1:_.isArray(vc.shortcode_relevance["parent_except_"+e])&&_.contains(vc.shortcode_relevance["parent_except_"+e],t)?!1:_.isArray(vc.shortcode_relevance["child_only_"+t])&&!_.contains(vc.shortcode_relevance["child_only_"+t],e)?!1:_.isArray(vc.shortcode_relevance["child_except_"+t])&&_.contains(vc.shortcode_relevance["child_except"+t],e)?!1:!0}},vc.CloneModel=function(e,t,n,a){vc.clone_index=vc.clone_index/10;var i,o,c,r,s;return i=_.isBoolean(a)&&a===!0?t.get("order"):parseFloat(t.get("order"))+vc.clone_index,o=_.extend({},t.get("params")),c=t.get("shortcode"),r={shortcode:c,parent_id:n,order:i,cloned:!0,cloned_from:t.toJSON(),params:o},vc["cloneMethod_"+c]&&(r=vc["cloneMethod_"+c](r,t)),_.isBoolean(a)&&a===!0||(r.place_after_id=t.get("id")),e.create(r),s=e.last(),_.each(vc.shortcodes.where({parent_id:t.get("id")}),function(t){vc.CloneModel(e,t,s.get("id"),!0)},this),s},vc.getColumnSize=function(e){var t=12%e,n=function(e){return _.isNumber(e)&&e%2==1};return t>0&&n(e)&&e%3?e+"/12":(0==t&&(t=e),e/t+"/"+12/t)},vc.showMessage=function(t){vc.message_timeout&&(e(".vc_message").remove(),window.clearTimeout(vc.message_timeout));var n=e('<div class="vc_message success" style="z-index: 999;">'+t+"</div>").prependTo(e("body"));n.fadeIn(500),vc.message_timeout=window.setTimeout(function(){n.slideUp(500,function(){e(this).remove()}),vc.message_timeout=!1},5500)},window.InlineShortcodeView=vc.shortcode_view=Backbone.View.extend({hold_hover_on:!1,events:{"click > .vc_controls .vc_control-btn-delete":"destroy","click > .vc_controls .vc_control-btn-edit":"edit","click > .vc_controls .vc_control-btn-clone":"clone",mousemove:"checkControlsPosition"},controls_set:!1,$content:!1,move_timeout:!1,out_timeout:!1,hold_active:!0,builder:!1,default_controls_template:!1,initialize:function(){this.listenTo(this.model,"destroy",this.removeView),this.listenTo(this.model,"change:params",this.update),this.listenTo(this.model,"change:parent_id",this.changeParentId)},render:function(){this.$el.attr("data-model-id",this.model.get("id"));var e=this.model.get("shortcode");this.$el.attr("data-tag",e),this.$el.addClass("vc_"+e),this.addControls();var t=_.isObject(vc.getMapped(e))&&(_.isBoolean(vc.getMapped(e).is_container)&&vc.getMapped(e).is_container===!0||!_.isEmpty(vc.getMapped(e).as_parent));return t&&this.$el.addClass("vc_container-block"),this.changed(),this},checkControlsPosition:function(){if(this.$controls_buttons){var t,n,a,i,o=this.$el.height(),c=vc.$frame.height();o>c&&(t=e(vc.frame_window).scrollTop(),n=this.$controls_buttons.offset().top,a=this.$el.offset().top,i=t-a+vc.$frame.height()/2,i>40&&o>i?this.$controls_buttons.css("top",i):i>o?this.$controls_buttons.css("top",o-40):this.$controls_buttons.css("top",40))}},beforeUpdate:function(){},updated:function(){_.each(vc.shortcodes.where({parent_id:this.model.get("id")}),function(e){e.view.parent_view=this,e.view.parentChanged()},this),_.defer(_.bind(function(){vc.events.trigger("shortcodeView:updated",this.model),vc.events.trigger("shortcodeView:updated:"+this.model.get("shortcode"),this.model),vc.events.trigger("shortcodeView:updated:"+this.model.get("id"),this.model)},this))},parentChanged:function(){this.checkControlsPosition()},rendered:function(){_.defer(_.bind(function(){vc.events.trigger("shortcodeView:ready",this.model),vc.events.trigger("shortcodeView:ready:"+this.model.get("shortcode"),this.model),vc.events.trigger("shortcodeView:ready:"+this.model.get("id"),this.model)},this))},hasUserAccess:function(){var e;return e=this.model.get("shortcode"),-1<_.indexOf(["vc_row","vc_column","vc_row_inner","vc_column_inner"],e)?!0:_.every(vc.roles.current_user,function(t){return!(!_.isUndefined(vc.roles[t])&&!_.isUndefined(vc.roles[t].shortcodes)&&_.isUndefined(vc.roles[t].shortcodes[e]))})?!0:!1},addControls:function(){var t=this.model.get("shortcode"),n=e("#vc_controls-template-"+t),a=n.length?n.html():this._getDefaultTemplate(),i=vc.shortcodes.get(this.model.get("parent_id")),o={name:vc.getMapped(t).name,tag:t,parent_name:i?vc.getMapped(i.get("shortcode")).name:"",parent_tag:i?i.get("shortcode"):""};this.$controls=e(_.template(a,o,vc.template_options).trim()).addClass("vc_controls"),this.hasUserAccess()||this.$controls.find(".vc_control-btn:not(.vc_element-move)").remove(),this.$controls.appendTo(this.$el),this.$controls_buttons=this.$controls.find("> :first")},content:function(){return this.$content===!1&&(this.$content=this.$el.find("> :first")),this.$content},changeParentId:function(){var e,t=this.model.get("parent_id");vc.builder.notifyParent(this.model.get("parent_id")),t===!1?app.placeElement(this.$el):(e=vc.shortcodes.get(t),e&&e.view&&e.view.placeElement(this.$el)),this.parentChanged()},_getDefaultTemplate:function(){if(_.isUndefined(this.default_controls_template)||!this.default_controls_template){this.default_controls_template=e("<div><div>").html(e("#vc_controls-template-default").html());var t=this.$el.data("shortcode-controls");_.isUndefined(t)||e(".vc_control-btn[data-control]",this.default_controls_template).each(function(){-1==e.inArray(e(this).data("control"),t)&&e(this).remove()})}return this.default_controls_template.html()},changed:function(){this.$el.removeClass("vc_empty-shortcode-element"),0===this.$el.height()&&this.$el.addClass("vc_empty-shortcode-element")},edit:function(e){_.isObject(e)&&e.preventDefault()&&e.stopPropagation(),"edit_element"===vc.activePanelName()&&vc.active_panel.model&&vc.active_panel.model.get("id")===this.model.get("id")||(vc.closeActivePanel(),vc.edit_element_block_view.render(this.model))},destroy:function(e){_.isObject(e)&&e.preventDefault()&&e.stopPropagation();var t=confirm(window.i18nLocale.press_ok_to_delete_section);return!0!==t?!1:(vc.showMessage(window.sprintf(window.i18nLocale.inline_element_deleted,this.model.setting("name"))),void this.model.destroy())},removeView:function(e){this.remove(),vc.setDataChanged(),vc.builder.notifyParent(this.model.get("parent_id")),vc.closeActivePanel(e),vc.setFrameSize()},update:function(e){this.beforeUpdate(),vc.builder.update(e)},clone:function(e){var t,n=new vc.ShortcodesBuilder;return _.isObject(e)&&e.preventDefault()&&e.stopPropagation(),this.builder&&!this.builder.is_build_complete?!1:(this.builder=n,t=vc.CloneModel(n,this.model,this.model.get("parent_id")),n.setResultMessage(window.sprintf(window.i18nLocale.inline_element_cloned,t.setting("name"),t.get("id"))),void n.render())},getParam:function(e){return _.isObject(this.model.get("params"))&&!_.isUndefined(this.model.get("params")[e])?this.model.get("params")[e]:null},placeElement:function(e,t){var n=vc.shortcodes.get(e.data("modelId"));n&&n.get("place_after_id")?(e.insertAfter(vc.$page.find("[data-model-id="+n.get("place_after_id")+"]")),n.unset("place_after_id")):_.isString(t)&&"prepend"===t?e.prependTo(this.content()):e.appendTo(this.content()),this.changed()}}),vc.FrameView=Backbone.View.extend({events:{"click .vc_add-element-action":"addElement","click #vc_no-content-add-text-block":"addTextBlock","click #vc_templates-more-layouts":"openTemplatesWindow","click .vc_template[data-template_unique_id] > .wpb_wrapper":"loadDefaultTemplate"},openTemplatesWindow:function(e){vc.app.openTemplatesWindow.call(this,e)},updateKeyPress:function(t){return 13===t.which?(t.preventDefault(),vc.$title.attr("contenteditable",!1),e(".entry-content").trigger("click"),!1):void 0},loadDefaultTemplate:function(t){t&&t.preventDefault(),vc.templates_panel_view.loadTemplate(t),e("#vc_no-content-helper").remove()},setTitle:function(e){vc.$title.length&&vc.$title.text(e||vc.no_title_placeholder),vc.title=e,vc.update_title=!0},initialize:function(){vc.frame_window=vc.$frame.get(0).contentWindow},setActiveHover:function(t){this.$hover_element&&this.$hover_element.removeClass("vc_hover"),this.$hover_element=e(t.currentTarget).addClass("vc_hover"),t.stopPropagation()},unsetActiveHover:function(){this.$hover_element&&this.$hover_element.removeClass("vc_hover")},setSortable:function(){vc.frame_window.vc_iframe.setSortable(vc.app)},render:function(){return vc.$title=e(vc.$frame.get(0).contentWindow.document).find('h1:contains("'+(vc.title||vc.no_title_placeholder).replace(/"/g,'\\"')+'")'),vc.$title.click(function(e){e.preventDefault(),vc.post_settings_view.render().show()}),vc.events.off("shortcodes:add",vc.atts.addShortcodeIdParam,this).bind("shortcodes:add",vc.atts.addShortcodeIdParam,this),this},noContent:function(e){vc.frame_window.vc_iframe.showNoContent(e)},addElement:function(e){e&&e.preventDefault&&e.preventDefault(),vc.add_element_block_view.render(!1)},addTextBlock:function(e){e&&e.preventDefault&&e.preventDefault();var t=new vc.ShortcodesBuilder;t.create({shortcode:"vc_row"}).create({shortcode:"vc_column",parent_id:t.lastID(),params:{width:"1/1"}}).create({shortcode:"vc_column_text",parent_id:t.lastID(),params:vc.getDefaults("vc_column_text")}).render(),vc.edit_element_block_view.render(t.last())},scrollTo:function(e){vc.frame_window.vc_iframe.scrollTo(e.get("id"))},addInlineScript:function(e){return vc.frame_window.vc_iframe.addInlineScript(e)},addInlineScriptBody:function(e){return vc.frame_window.vc_iframe.addInlineScriptBody(e)}}),vc.View=Backbone.View.extend({el:e("body"),mode:"view",current_size:"100%",events:{"click #vc_add-new-row":"createRow","click #vc_add-new-element":"addElement","click #vc_post-settings-button":"editSettings","click #vc_templates-editor-button":"openTemplatesWindow","click #vc_guides-toggle-button":"toggleMode","click #vc_button-cancel":"cancel","click #vc_button-edit-admin":"cancel","click #vc_button-update":"save","click #vc_button-save-draft, #vc_button-save-as-pending":"save","click .vc_screen-width":"resizeFrame","click .vc_edit-cloned":"editCloned"},initialize:function(){_.bindAll(this,"saveRowOrder","saveElementOrder","saveColumnOrder","resizeWindow"),vc.shortcodes.on("change:params",this.changeParamsEvents,this),vc.events.on("shortcodes:add",vcAddShortcodeDefaultParams,this)},changeParamsEvents:function(e){vc.events.triggerShortcodeEvents("update",e)},render:function(){return vc.updateSettingsBadge(),vc.$page=e(vc.$frame.get(0).contentWindow.document).find("#vc_inline-anchor").parent(),vc.$frame_body=e(vc.$frame.get(0).contentWindow.document).find("body").addClass("vc_editor"),this.setMode("compose"),this.$size_control=e("#vc_screen-size-control"),e(".vc_element-container",vc.frame_window.document).droppable({accept:".vc_element_button"}),e(window).resize(this.resizeWindow),_.defer(function(){vc.events.trigger("app.render")}),this},cancel:function(t){_.isObject(t)&&t.preventDefault(),window.location.href=e(t.currentTarget).data("url")},save:function(t){_.isObject(t)&&t.preventDefault(),vc.builder.save(e(t.currentTarget).data("changeStatus"))},resizeFrame:function(t){var n=e(t.currentTarget);return t.preventDefault(),n.hasClass("active")?!1:(this.$size_control.find(".active").removeClass("active"),e("#vc_screen-size-current").attr("class","vc_icon "+n.attr("class")),this.current_size=n.data("size"),n.addClass("active"),void vc.setFrameSize(this.current_size))},editCloned:function(t){t&&t.preventDefault();var n=e(t.currentTarget),a=n.data("modelId"),i=vc.shortcodes.get(a);vc.edit_element_block_view.render(i)},resizeWindow:function(){vc.setFrameSize(this.current_size)},switchMode:function(t){var n=e(t.currentTarget);t&&t.preventDefault(),this.setMode(n.data("mode")),n.siblings(".vc_active").removeClass("vc_active"),n.addClass("vc_active")},toggleMode:function(t){var n=e(t.currentTarget);t&&t.preventDefault(),"compose"===this.mode?(n.addClass("vc_off").text(window.i18nLocale.guides_off),this.setMode("view")):(n.removeClass("vc_off").text(window.i18nLocale.guides_on),this.setMode("compose"))},setMode:function(t){var n=e("body").removeClass(this.mode+"-mode");vc.$frame_body.removeClass(this.mode+"-mode"),this.mode=t,n.addClass(this.mode+"-mode"),vc.$frame_body.addClass(this.mode+"-mode")},placeElement:function(e,t){var n=vc.shortcodes.get(e.data("modelId"));n&&n.get("place_after_id")?(e.insertAfter(vc.$page.find("[data-model-id="+n.get("place_after_id")+"]")),n.unset("place_after_id")):_.isString(t)&&"prepend"===t?e.prependTo(vc.$page):e.insertBefore(vc.$page.find("#vc_no-content-helper"))},addShortcodes:function(e){_.each(e,function(e){this.addShortcode(e),this.addShortcodes(vc.shortcodes.where({parent_id:e.get("id")}))},this)},createShortcodeHtml:function(t){var n=e("#vc_template-"+t.get("shortcode")),a=n.length?n.html():'<div class="vc_block"></div>';return e(_.template(a,t.toJSON(),vc.template_options).trim())},addAll:function(e){this.addShortcodes(e.where({parent_id:!1}))},createRow:function(e){_.isObject(e)&&e.preventDefault();var t=new vc.ShortcodesBuilder;t.create({shortcode:"vc_row"}).create({shortcode:"vc_column",parent_id:t.lastID(),params:{width:"1/1"}}).render()},addElement:function(e){e&&e.preventDefault(),vc.add_element_block_view.render(!1)},editSettings:function(e){e&&e.preventDefault(),vc.post_settings_view.render().show()},openTemplatesEditor:function(e){e&&e.preventDefault&&e.preventDefault(),vc.templates_editor_view.render().show()},openTemplatesWindow:function(e){e&&e.preventDefault&&e.preventDefault(),vc.templates_panel_view.render().show()},setFrameSize:function(){vc.setFrameSize()},dropButton:function(){},saveRowOrder:function(){_.defer(function(){var t=vc.$page.find("> [data-tag=vc_row]"),n=new vc.ShortcodesBuilder;t.each(function(a){var i=e(this);if(i.is(".droppable")){i.remove();var o={shortcode:"vc_row",order:a};0===a?vc.activity="prepend":a+1!=t.length&&(o.place_after_id=vc.$page.find("> [data-tag=vc_row]:eq("+(a-1)+")").data("modelId")),n.create(o).create({shortcode:"vc_column",parent_id:n.lastID(),params:{width:"1/1"}}).render()}else vc.shortcodes.get(i.data("modelId")).save({order:a},{silent:!0})}),vc.setDataChanged()},this)},saveElementOrder:function(t,n){_.defer(function(t,n,a){if(_.isNull(a.sender)){var i=a.item.parent(),o=i.find("> [data-model-id]");i.find("> [data-model-id]").each(function(t){var n,a,c,r=e(this),s=!1;r.is(".droppable")?(c=vc.shortcodes.get(i.parents(".vc_element[data-tag]:first").data("modelId")),r.remove(),0===t?s=!0:t+1!=o.length&&(s=i.find("> [data-tag]:eq("+(t-1)+")").data("modelId")),c&&vc.add_element_block_view.render(c,s)):(n=vc.shortcodes.get(r.data("modelId")),a=n.get("parent_id"),c=i.parents(".vc_element[data-tag]:first").data("modelId"),n.save({order:t,parent_id:c},{silent:!0}),a!==c&&(vc.builder.notifyParent(c),vc.builder.notifyParent(a)))})}vc.setDataChanged()},this,t,n)},saveColumnOrder:function(t,n){_.defer(function(t,n,a){var i=a.item.parent();i.find("> [data-model-id]").each(function(){var t=e(this),n=t.index();vc.shortcodes.get(t.data("modelId")).save({order:n})})},this,t,n),vc.setDataChanged()}})}(window.jQuery);