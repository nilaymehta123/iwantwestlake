!function(){_.isUndefined(window.vc)&&(window.vc={});var e=Backbone.Model.extend({defaults:function(){var e=vc_guid();return{id:e,shortcode:"vc_text_block",order:vc.shortcodes.nextOrder(),params:{},parent_id:!1}},settings:!1,getParam:function(e){return _.isObject(this.get("params"))&&!_.isUndefined(this.get("params")[e])?this.get("params")[e]:""},sync:function(){return!1},setting:function(e){return this.settings===!1&&(this.settings=vc.getMapped(this.get("shortcode"))||{}),this.settings[e]},view:!1}),t=Backbone.Collection.extend({model:e,sync:function(){return!1},nextOrder:function(){return this.length?this.last().get("order")+1:1},initialize:function(){this.bind("remove",this.removeChildren,this),this.bind("remove",vc.builder.checkNoContent),this.bind("remove",this.removeEvents,this)},comparator:function(e){return e.get("order")},removeEvents:function(e){vc.events.triggerShortcodeEvents("destroy",e)},removeChildren:function(e){var t=vc.shortcodes.where({parent_id:e.id});_.each(t,function(e){e.destroy()},this)},stringify:function(e){return this.modelsToString(_.sortBy(vc.shortcodes.where({parent_id:!1}),function(e){return e.get("order")}),e)},modelsToString:function(e,t){var n="";return _.each(e,function(e){var r,i,o,s,c,d;i=e.get("shortcode"),o=_.extend({},e.get("params")),c={},d=vc.getMergedParams(i,o),_.each(d,function(e,t){"content"!==t&&(c[t]=vc.storage.escapeParam(e))},this),s=_.isString(o.content)?o.content:"",s+=this.modelsToString(_.sortBy(vc.shortcodes.where({parent_id:e.get("id")}),function(e){return e.get("order")}),t),r={tag:i,attrs:c,content:s,type:_.isUndefined(vc.getParamSettings(i,"content"))&&!vc.getMapped(i).is_container?"single":""},_.isUndefined(t)?e.trigger("stringify",e,r):e.trigger("stringify:"+t,e,r),n+=wp.shortcode.string(r)},this),n},create:function(e,n){return e=t.__super__.create.call(this,e,n),e.get("cloned")&&vc.events.triggerShortcodeEvents("clone",e),vc.events.triggerShortcodeEvents("add",e),e}});vc.shortcodes=new t}(window.jQuery);