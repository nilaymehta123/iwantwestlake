!function(t){_.isUndefined(window.vc)&&(window.vc={}),vc.ShortcodesBuilder=function(t){return this.models=t||[],this.is_build_complete=!0,this},vc.ShortcodesBuilder.prototype={_ajax:!1,message:!1,isBuildComplete:function(){return this.is_build_complete},create:function(t){return this.is_build_complete=!1,this.models.push(vc.shortcodes.create(t)),this},render:function(t){var e;e=_.map(this.models,function(t){var e=this.toString(t);return{id:t.get("id"),string:e,tag:t.get("shortcode")}},this),vc.setDataChanged(),this.build(e,t)},build:function(e,n){this.ajax({action:"vc_load_shortcode",shortcodes:e},vc.frame_window.location.href).done(function(e){_.each(t(e),function(t){this._renderBlockCallback(t)},this),_.isFunction(n)&&n(e),vc.frame.setSortable(),vc.activity=!1,this.checkNoContent(),vc.frame_window.vc_iframe.loadScripts(),this.last()&&vc.frame.scrollTo(this.first()),this.models=[],this.showResultMessage(),this.is_build_complete=!0})},lastID:function(){return this.models.length?_.last(this.models).get("id"):""},last:function(){return this.models.length?_.last(this.models):!1},firstID:function(){return this.models.length?_.first(this.models).get("id"):""},first:function(){return this.models.length?_.first(this.models):!1},buildFromContent:function(){var e=decodeURIComponent(vc.frame_window.jQuery("#vc_template-post-content").html()+"").replace(/\<style([^\>]*)\>\/\*\* vc_js\-placeholder \*\*\//g,"<script$1>").replace(/\<\/style([^\>]*)\>\<\!\-\- vc_js\-placeholder \-\-\>/g,"</script$1>");try{vc.$page.html(e).prepend(t('<div class="vc_empty-placeholder"></div>'))}catch(n){window.console&&window.console.error&&console.error(n)}_.each(vc.post_shortcodes,function(t){var e=JSON.parse(decodeURIComponent(t+"")),n=vc.$page.find("[data-model-id="+e.id+"]"),i=(n.parents("[data-model-id]"),_.isObject(e.attrs)?e.attrs:{}),s=vc.shortcodes.create({id:e.id,shortcode:e.tag,params:this.unescapeParams(i),parent_id:e.parent_id,from_content:!0},{silent:!0});n.attr("data-model-id",s.get("id")),this._renderBlockCallback(n.get(0))},this),vc.frame.setSortable(),this.checkNoContent(),vc.frame.render();try{vc.frame_window.vc_iframe.reload()}catch(n){window.console&&window.console.error&&console.error(n)}},buildFromTemplate:function(e,n){var i;return i=!1,_.each(t(e),function(e){var n=t(e);n.is("[data-type=files]")?this._renderBlockCallback(e):vc.app.placeElement(n)},this),_.each(n,function(t){var e,n,s,o,r;e=JSON.parse(decodeURIComponent(t+"")),n=vc.$page.find("[data-model-id="+e.id+"]"),s=_.isObject(e.attrs)?e.attrs:{},i||(r=vc.shortcodeHasIdParam(e.tag),r&&!_.isUndefined(s)&&!_.isUndefined(s[r.param_name])&&s[r.param_name].length>0&&(i=!0)),o=vc.shortcodes.create({id:e.id,shortcode:e.tag,params:this.unescapeParams(s),parent_id:e.parent_id,from_template:!0}),n.attr("data-model-id",o.get("id")),this._renderBlockCallback(n.get(0))},this),vc.frame.setSortable(),vc.activity=!1,this.checkNoContent(),vc.frame_window.vc_iframe.loadScripts(),this.last()&&vc.frame.scrollTo(this.first()),this.models=[],this.showResultMessage(),vc.frame.render(),this.is_build_complete=!0,i},_renderBlockCallback:function(e){var n,i,s=t(e);"files"===s.data("type")?(vc.frame_window.vc_iframe.addScripts(s.find("script,link")),vc.frame_window.vc_iframe.addStyles(s.find("style"))):(i=vc.shortcodes.get(s.data("modelId")),n=s.is("[data-type=element]")?t(s.html()):s,i&&i.get("shortcode")&&this.renderShortcode(n,i)),vc.setFrameSize()},renderShortcode:function(e,n){var i,s,o;i=this.getView(n),s=e,vc.last_inner=s.html(),t("script",s).each(function(){if(t(this).attr("src")){var e=vc.frame.addInlineScript(t(this));t('<span class="js_placeholder_'+e+'"></span>').insertAfter(t(this)),o=!0}else{var n=vc.frame.addInlineScriptBody(t(this));t('<span class="js_placeholder_inline_'+n+'"></span>').insertAfter(t(this)),o=!0}t(this).remove()}),o&&e.html(s.html()),!n.get("from_content")&&!n.get("from_template")&&this.placeContainer(e,n),n.view=new i({model:n,el:e}).render(),this.notifyParent(n.get("parent_id")),n.view.rendered()},getView:function(t){var e=t.setting("is_container")||t.setting("as_parent")?InlineShortcodeViewContainer:InlineShortcodeView;return _.isObject(window["InlineShortcodeView_"+t.get("shortcode")])&&(e=window["InlineShortcodeView_"+t.get("shortcode")]),e},update:function(e){var n,i;n=e.get("shortcode"),i=this.toString(e),vc.setDataChanged(),this.ajax({action:"vc_load_shortcode",shortcodes:[{id:e.get("id"),string:i,tag:n}]},vc.frame_window.location.href).done(function(n){var i;i=e.view,_.each(t(n),function(t){this._renderBlockCallback(t)},this),e.view&&(e.view.$el.insertAfter(i.$el),vc.shortcodes.where({parent_id:e.get("id")}).length&&i.content().find("> *").appendTo(e.view.content()),i.remove(),vc.frame_window.vc_iframe.loadScripts(),e.view.changed(),vc.frame.setSortable(),e.view.updated())})},ajax:function(e,n){return this._ajax=t.ajax({url:n||vc.admin_ajax,type:"POST",dataType:"html",data:_.extend({post_id:vc.post_id,vc_inline:!0},e),context:this})},notifyParent:function(t){var e=vc.shortcodes.get(t);e&&e.view&&e.view.changed()},remove:function(){},_getContainer:function(t){var e,n,i=t.get("parent_id");if(i!==!1){if(n=vc.shortcodes.get(i),_.isUndefined(n))return vc.app;e=n.view}else e=vc.app;return e},placeContainer:function(t,e){var n=this._getContainer(e);return n&&n.placeElement(t,vc.activity),n},toString:function(t,e){var n,i,s,o,r;return n={},r=t.get("shortcode"),i=_.extend({},t.get("params")),o=vc.getMergedParams(r,i),s=_.isString(i.content)?i.content:"",_.each(o,function(t,e){"content"!==e&&(n[e]=this.escapeParam(t))},this),wp.shortcode.string({tag:r,attrs:n,content:s,type:_.isString(e)?e:""})},modelsToString:function(t){var e;return e="",_.each(t,function(t){var n,i,s,o,r,a;n=t.get("shortcode"),i=_.extend({},t.get("params")),s=_.isString(i.content)?i.content:"",o={},r=vc.getMergedParams(n,i),s+=this.modelsToString(vc.shortcodes.where({parent_id:t.get("id")})),a=_.isObject(vc.getMapped(n))&&(_.isBoolean(vc.getMapped(n).is_container)&&vc.getMapped(n).is_container===!0||!_.isEmpty(vc.getMapped(n).as_parent)),_.each(r,function(t,e){"content"!==e&&(o[e]=this.escapeParam(t))},this),e+=wp.shortcode.string({tag:n,attrs:o,content:s,type:_.isUndefined(vc.getParamSettings(n,"content"))&&!a?"single":""})},this),e},getContent:function(){return vc.shortcodes.sort(),this.modelsToString(vc.shortcodes.where({parent_id:!1}))},getTitle:function(){return vc.title},checkNoContent:function(){vc.frame.noContent(!vc.shortcodes.length)},save:function(e){var n=this.getContent(),i=t("#post").serializeArray(),s={};for(var o in i){var r,a;r=i[o].name.replace("[]",""),a=i[o].value,_.isUndefined(s[r])||s[r]==a?s[r]=a:_.isArray(s[r])?s[r].push(a):(s[r]=[s[r]],s[r].push(a))}s.vc_post_custom_css=vc.$custom_css.val(),s.content=this.wpautop(n),e&&(s.post_status=e,t(".vc_button_save_draft").hide(100)&&t("#vc_button-update").text(window.i18nLocale.update_all)),vc.update_title&&(s.post_title=this.getTitle()),this.ajax(s,"post.php").done(function(){vc.unsetDataChanged(),vc.showMessage("Successfully updated!")})},parse:function(t,e,n){var i=_.keys(vc.map).join("|"),s=window.wp.shortcode.regexp(i),o=e.trim().match(s);return _.isNull(o)?t:(_.each(o,function(e){var s,o,r=e.match(this.regexp(i)),a=r[5],c=new RegExp("^[\\s]*\\[\\[?("+_.keys(vc.map).join("|")+")(?![\\w-])"),d=window.wp.shortcode.attrs(r[3]),h={},l=vc_guid();_.each(d.named,function(t,e){h[e]=this.unescapeParam(t)},this),s={id:l,shortcode:r[2],params:_.extend({},h),parent_id:_.isObject(n)?n.id:!1},o=vc.getMapped(s.shortcode),t[l]=s,l==s.root_id&&(t[l].html=e),_.isString(a)&&a.match(c)&&(o.is_container&&_.isBoolean(o.is_container)&&o.is_container===!0||!_.isEmpty(o.as_parent)&&o.as_parent!==!1)?t=this.parseContent(t,a,t[l]):_.isString(a)&&a.length&&"vc_row"===r[2]?t=this.parseContent(t,'[vc_column width="1/1"][vc_column_text]'+a+"[/vc_column_text][/vc_column]",t[l]):_.isString(a)&&a.length&&"vc_column"===r[2]?t=this.parseContent(t,"[vc_column_text]"+a+"[/vc_column_text]",t[l]):_.isString(a)&&(t[l].params.content=a)},this),t)},regexp:_.memoize(function(t){return new RegExp("\\[(\\[?)("+t+")(?![\\w-])([^\\]\\/]*(?:\\/(?!\\])[^\\]\\/]*)*?)(?:(\\/)\\]|\\](?:([^\\[]*(?:\\[(?!\\/\\2\\])[^\\[]*)*)(\\[\\/\\2\\]))?)(\\]?)")}),escapeParam:function(t){return _.isString(t)?t.replace(/"/g,"``"):_.isUndefined(t)||_.isNull(t)||!t.toString?"":t.toString().replace(/"/g,"``")},wpautop:function(t){var e="content";return window.tinyMCEPreInit.mceInit[e]&&window.tinyMCEPreInit.mceInit[e].wpautop&&window.switchEditors&&window.switchEditors.wpautop?window.switchEditors.pre_wpautop(window.switchEditors.wpautop(t)):t},unescapeParam:function(t){return t.replace(/(\`{2})/g,'"')},unescapeParams:function(t){return _.object(_.map(t,function(t,e){return[e,this.unescapeParam(t)]},this))},setResultMessage:function(t){this.message=t},showResultMessage:function(){this.message!==!1&&vc.showMessage(this.message),this.message=!1}},vc.builder=new vc.ShortcodesBuilder}(window.jQuery);